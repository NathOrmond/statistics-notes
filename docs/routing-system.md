# Navigation Routing System Documentation

## Overview

This project uses an **automated navigation generation system** to build the website's navigation menu from the directory structure. Instead of manually maintaining hardcoded paths in `_quarto.yml`, the system scans the `src/` directory and automatically generates navigation links based on:

1. **Directory structure** - Folders become menu categories
2. **File locations** - `.qmd` files become menu items
3. **YAML metadata** - Titles are extracted from each file's front matter

## How It Works

### The Generation Script

The navigation is generated by `scripts/generate_nav.R`, which:

1. **Scans** the `src/` directory for all `.qmd` files
2. **Extracts** titles from YAML front matter headers
3. **Builds** a hierarchical navigation structure matching the directory tree
4. **Updates** `_quarto.yml` with the generated navigation

### Directory Structure Mapping

The routing system follows this mapping:

```
src/
├── teaching-stats/           → "Teaching Stats" menu
│   └── core-concepts/        → "Core Concepts" submenu
│       ├── *.qmd files       → Individual menu items
│
└── blog/                     → "Blog" menu
    ├── paper-reviews/        → "Paper Reviews" submenu
    │   ├── index.qmd         → "Overview" menu item
    │   └── */                → Nested submenus
    └── essays/               → "Essays" submenu
```

### Navigation Rules

#### 1. File Discovery

- **Includes**: All `.qmd` files in `src/` and subdirectories
- **Excludes**:
  - Files named `template.qmd` (templates are not content)
  - Files named `index.qmd` (handled separately as "Overview" items)
  
#### 2. Title Extraction

Titles are determined in priority order:

1. **YAML `title:` field** - Extracted from file's front matter (preferred)
2. **Filename** - Fallback: filename converted to title case

Example YAML header:
```yaml
---
title: "Central Limit Theorem"
subtitle: "Building an Intuition..."
---
```

#### 3. Path Conversion

File paths are converted to navigation `href` attributes:

- **Source**: `src/teaching-stats/core-concepts/central-limit-theorem.qmd`
- **Href**: `src/teaching-stats/core-concepts/central-limit-theorem.qmd`
- Paths are **relative to the project root**

#### 4. Menu Structure Generation

The script creates nested menus following these rules:

- **Top-level directories** under `src/` become main menu categories
- **Subdirectories** become submenus within their parent category
- **Files in directories** become menu items
- **`index.qmd` files** become "Overview" items at the top of their submenu
- **Empty directories** show empty menus (ready for future content)

#### 5. Special Cases

##### Index Files

Files named `index.qmd` are treated specially:
- Not included in the main file listing
- Added as the first item in their directory's menu with text "Overview"
- Example: `src/blog/paper-reviews/index.qmd` → Menu item "Overview"

##### Nested Subdirectories

Nested directories create nested menus:
- `src/blog/paper-reviews/chatbot-mental-health/` → "Chatbot Mental Health" submenu
- Files inside become items in that submenu

##### Empty Categories

Empty directories (like `src/blog/essays/`) create empty menus:
```yaml
- text: Essays
  menu: []
```

## Usage

### Generating Navigation

Run the script after adding, moving, or renaming content files:

```bash
Rscript scripts/generate_nav.R
```

Or from R:

```r
source("scripts/generate_nav.R")
```

### What Gets Updated

The script **only updates the `navbar` section** of `_quarto.yml`. All other configuration is preserved:
- `project` settings
- `website` title, site-url
- `format` options
- `editor` settings

### Workflow Example

1. **Create a new page**:
   ```bash
   cp src/teaching-stats/core-concepts/template.qmd \
      src/teaching-stats/core-concepts/my-new-concept.qmd
   ```

2. **Edit the file** with your content and proper YAML header:
   ```yaml
   ---
   title: "My New Concept"
   ---
   ```

3. **Generate navigation**:
   ```bash
   Rscript scripts/generate_nav.R
   ```

4. **Result**: The new page automatically appears in the navigation under "Teaching Stats → Core Concepts"

## Navigation Structure Reference

### Current Navigation Hierarchy

```
Home (index.qmd)
├── Teaching Stats
│   └── Core Concepts
│       ├── Central Limit Theorem
│       └── Degrees of Freedom
├── Blog
│   ├── Paper Reviews
│   │   ├── Overview (index.qmd)
│   │   └── Chatbot Mental Health
│   │       └── Chatbot Effects On Postpartum Mental Health
│   └── Essays (empty)
└── About (about.qmd)
```

### Path Reference

All paths in navigation are relative to the project root:

| Navigation Item | File Path |
|----------------|-----------|
| Central Limit Theorem | `src/teaching-stats/core-concepts/central-limit-theorem.qmd` |
| Paper Reviews Overview | `src/blog/paper-reviews/index.qmd` |
| Chatbot Paper | `src/blog/paper-reviews/chatbot-mental-health/chatbot-postpartum-mental-health.qmd` |

## Configuration

### Customising the Script

The script can be customised by editing `scripts/generate_nav.R`:

#### Exclude Patterns

Files matching these patterns are excluded from navigation:
```r
exclude_patterns <- c("template\\.qmd$", "index\\.qmd$")
```

To exclude additional files (e.g., drafts), add patterns:
```r
exclude_patterns <- c(
  "template\\.qmd$",
  "index\\.qmd$",
  "draft-.*\\.qmd$"  # Exclude files starting with "draft-"
)
```

#### Source Directory

Change the source directory (default: `src`):
```r
src_dir <- "content"  # Use "content" instead of "src"
```

#### Menu Labels

Menu labels are automatically generated from directory names:
- `core-concepts` → "Core Concepts" (hyphens to spaces, title case)
- `paper-reviews` → "Paper Reviews"
- `chatbot-mental-health` → "Chatbot Mental Health"

To customise menu labels, modify the `build_nav()` function's display name formatting.

## Troubleshooting

### Navigation Not Updating

**Problem**: Changes to files don't appear in navigation

**Solution**: 
1. Ensure file is in `src/` directory
2. Run `Rscript scripts/generate_nav.R` again
3. Check file has valid YAML header with `title:` field
4. Verify file doesn't match exclude patterns

### Missing Menu Items

**Problem**: A file exists but doesn't appear in navigation

**Possible causes**:
- File matches an exclude pattern (e.g., `template.qmd`)
- File has invalid YAML header (script falls back to filename)
- File is outside `src/` directory

**Solution**: Check file location and YAML header format.

### Incorrect Titles

**Problem**: Navigation shows filename instead of title

**Solution**: Ensure your `.qmd` file has a valid YAML header:
```yaml
---
title: "Your Page Title"
---
```

### Nested Menu Issues

**Problem**: Nested menus not appearing correctly

**Solution**: 
- Ensure subdirectories contain `.qmd` files (not just empty folders)
- Check that paths are correctly structured
- Verify `index.qmd` files exist if you want "Overview" items

## Best Practices

### Organising Content

1. **Use descriptive directory names**: They become menu labels (hyphens become spaces)
2. **Use meaningful filenames**: Used as fallback if YAML title is missing
3. **Always include YAML titles**: Better control over navigation labels

### Directory Structure

```
src/
├── teaching-stats/
│   ├── core-concepts/      ← Clear category name
│   ├── advanced-topics/    ← Future expansion ready
│   └── tutorials/          ← Organised by type
└── blog/
    ├── paper-reviews/
    └── essays/
```

### YAML Headers

Always include a `title:` field:
```yaml
---
title: "Descriptive Page Title"
subtitle: "Optional subtitle"
---
```

### Running the Generator

- **Run after**: Adding new pages, moving files, renaming directories
- **Run before**: Committing navigation changes
- **CI/CD**: Consider adding to your build pipeline if navigation must stay in sync

## Technical Details

### Dependencies

The script requires:
- `yaml` package (for YAML parsing)
- `fs` package (for filesystem operations)

Install with:
```r
install.packages(c("yaml", "fs"))
```

### File Paths

All paths are:
- **Relative to project root** (where `_quarto.yml` is located)
- **Preserved exactly** as they appear in the filesystem
- **No transformation** applied (paths match file locations)

### YAML Writing

The script uses `yaml::write_yaml()` which:
- Preserves existing YAML structure
- Only updates the `navbar` section
- Maintains formatting preferences (strings quoted vs unquoted)

## Future Enhancements

Potential improvements to consider:

1. **Sorting options**: Alphabetical vs. date-based ordering
2. **Custom menu labels**: Override auto-generated names via config file
3. **Weight/priority**: Order items manually if needed
4. **Active state detection**: Highlight current page in navigation
5. **Multi-level flattening**: Option to skip intermediate directory levels

## Related Documentation

- [Quarto Website Navigation](https://quarto.org/docs/websites/website-navigation.html)
- [YAML Format Specification](https://yaml.org/spec/)
- Project README: `README.md` (project overview and setup)

