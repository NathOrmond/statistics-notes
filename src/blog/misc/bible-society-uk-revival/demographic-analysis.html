<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Demographic Analysis – Nathans Stats Stuff</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<script src="../../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap-0b37c64f34216b628666a8dac638b53b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">Nathans Stats Stuff</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-teaching-stats" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Teaching Stats</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-teaching-stats">    
        <li>
    <a class="dropdown-item" href="../../../../src/teaching-stats/core-concepts/index.html">
 <span class="dropdown-text">Core Concepts</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-blog" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Blog</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-blog">    
        <li>
    <a class="dropdown-item" href="../../../../src/blog/misc/index.html">
 <span class="dropdown-text">Misc</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../src/blog/paper-reviews/index.html">
 <span class="dropdown-text">Paper Reviews</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#ons-migration-data-analysis" id="toc-ons-migration-data-analysis" class="nav-link" data-scroll-target="#ons-migration-data-analysis">ONS Migration Data Analysis</a>
  <ul class="collapse">
  <li><a href="#loading-and-preparing-ons-data" id="toc-loading-and-preparing-ons-data" class="nav-link" data-scroll-target="#loading-and-preparing-ons-data">Loading and Preparing ONS Data</a></li>
  <li><a href="#net-migration-trends-2018-2024" id="toc-net-migration-trends-2018-2024" class="nav-link" data-scroll-target="#net-migration-trends-2018-2024">Net Migration Trends (2018-2024)</a></li>
  <li><a href="#cumulative-impact-how-much-did-immigration-change-the-population" id="toc-cumulative-impact-how-much-did-immigration-change-the-population" class="nav-link" data-scroll-target="#cumulative-impact-how-much-did-immigration-change-the-population">Cumulative Impact: How Much Did Immigration Change the Population?</a></li>
  <li><a href="#immigration-components-who-arrived" id="toc-immigration-components-who-arrived" class="nav-link" data-scroll-target="#immigration-components-who-arrived">Immigration Components: Who Arrived?</a></li>
  <li><a href="#the-composition-change-problem" id="toc-the-composition-change-problem" class="nav-link" data-scroll-target="#the-composition-change-problem">The Composition Change Problem</a></li>
  <li><a href="#age-composition-of-immigrants-the-smoking-gun" id="toc-age-composition-of-immigrants-the-smoking-gun" class="nav-link" data-scroll-target="#age-composition-of-immigrants-the-smoking-gun">Age Composition of Immigrants: The Smoking Gun</a></li>
  <li><a href="#comparing-immigrant-age-composition-to-bible-society-survey-patterns" id="toc-comparing-immigrant-age-composition-to-bible-society-survey-patterns" class="nav-link" data-scroll-target="#comparing-immigrant-age-composition-to-bible-society-survey-patterns">Comparing Immigrant Age Composition to Bible Society Survey Patterns</a></li>
  </ul></li>
  <li><a href="#attendance-by-ethnicity-2024" id="toc-attendance-by-ethnicity-2024" class="nav-link" data-scroll-target="#attendance-by-ethnicity-2024">Attendance by Ethnicity (2024)</a>
  <ul class="collapse">
  <li><a href="#attendance-by-ethnicity" id="toc-attendance-by-ethnicity" class="nav-link" data-scroll-target="#attendance-by-ethnicity">2024 Attendance by Ethnicity</a></li>
  </ul></li>
  <li><a href="#age-stratified-analysis" id="toc-age-stratified-analysis" class="nav-link" data-scroll-target="#age-stratified-analysis">Age-Stratified Analysis</a>
  <ul class="collapse">
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section">2018</a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1">2024</a></li>
  <li><a href="#changes-2024---2018" id="toc-changes-2024---2018" class="nav-link" data-scroll-target="#changes-2024---2018">Changes (2024 - 2018)</a></li>
  </ul></li>
  <li><a href="#visualisation-age-stratified-changes" id="toc-visualisation-age-stratified-changes" class="nav-link" data-scroll-target="#visualisation-age-stratified-changes">Visualisation: Age-Stratified Changes</a></li>
  <li><a href="#full-frequency-distribution-2018-vs-2024" id="toc-full-frequency-distribution-2018-vs-2024" class="nav-link" data-scroll-target="#full-frequency-distribution-2018-vs-2024">Full Frequency Distribution (2018 vs 2024)</a></li>
  <li><a href="#immigration-and-church-attendance-the-critical-link" id="toc-immigration-and-church-attendance-the-critical-link" class="nav-link" data-scroll-target="#immigration-and-church-attendance-the-critical-link">Immigration and Church Attendance: The Critical Link</a>
  <ul class="collapse">
  <li><a href="#quantifying-the-potential-impact" id="toc-quantifying-the-potential-impact" class="nav-link" data-scroll-target="#quantifying-the-potential-impact">Quantifying the Potential Impact</a></li>
  <li><a href="#visualising-the-immigration-confound" id="toc-visualising-the-immigration-confound" class="nav-link" data-scroll-target="#visualising-the-immigration-confound">Visualising the Immigration Confound</a></li>
  <li><a href="#sensitivity-analysis-different-immigration-attendance-rates" id="toc-sensitivity-analysis-different-immigration-attendance-rates" class="nav-link" data-scroll-target="#sensitivity-analysis-different-immigration-attendance-rates">Sensitivity Analysis: Different Immigration Attendance Rates</a></li>
  </ul></li>
  <li><a href="#the-demographic-composition-problem" id="toc-the-demographic-composition-problem" class="nav-link" data-scroll-target="#the-demographic-composition-problem">The Demographic Composition Problem</a>
  <ul class="collapse">
  <li><a href="#major-population-changes-2018-2024-ons-confirmed" id="toc-major-population-changes-2018-2024-ons-confirmed" class="nav-link" data-scroll-target="#major-population-changes-2018-2024-ons-confirmed">Major population changes 2018-2024 (ONS Confirmed)</a></li>
  <li><a href="#problem-composition-vs-behaviour-change" id="toc-problem-composition-vs-behaviour-change" class="nav-link" data-scroll-target="#problem-composition-vs-behaviour-change">⚠️ PROBLEM: Composition vs Behaviour Change</a></li>
  </ul></li>
  <li><a href="#broader-methodological-issues-with-the-survey" id="toc-broader-methodological-issues-with-the-survey" class="nav-link" data-scroll-target="#broader-methodological-issues-with-the-survey">Broader Methodological Issues with the Survey</a></li>
  <li><a href="#implications-and-conclusions" id="toc-implications-and-conclusions" class="nav-link" data-scroll-target="#implications-and-conclusions">Implications and Conclusions</a>
  <ul class="collapse">
  <li><a href="#what-the-ons-data-reveals" id="toc-what-the-ons-data-reveals" class="nav-link" data-scroll-target="#what-the-ons-data-reveals">What the ONS Data Reveals</a></li>
  <li><a href="#what-we-cannot-determine-without-proper-controls" id="toc-what-we-cannot-determine-without-proper-controls" class="nav-link" data-scroll-target="#what-we-cannot-determine-without-proper-controls">What We Cannot Determine Without Proper Controls</a></li>
  <li><a href="#why-this-matters-for-the-revival-claim" id="toc-why-this-matters-for-the-revival-claim" class="nav-link" data-scroll-target="#why-this-matters-for-the-revival-claim">Why This Matters for the “Revival” Claim</a></li>
  <li><a href="#comparison-with-cofe-data" id="toc-comparison-with-cofe-data" class="nav-link" data-scroll-target="#comparison-with-cofe-data">Comparison with CofE Data</a></li>
  <li><a href="#methodological-recommendations" id="toc-methodological-recommendations" class="nav-link" data-scroll-target="#methodological-recommendations">Methodological Recommendations</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Demographic Analysis</h1>
<p class="subtitle lead">Population composition changes and their impact</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Between 2018 and 2024, the UK population composition changed significantly due to immigration. Using Office for National Statistics (ONS) provisional long-term international migration data, we can quantify these changes precisely and assess their potential impact on church attendance patterns.</p>
<p><strong>Key immigration flows 2018-2024</strong>:</p>
<ul>
<li><strong>Net migration</strong>: Cumulative +4.2 million (YE 2019 - YE 2024)</li>
<li><strong>Non-EU+ immigration surge</strong>: From 346,000 (YE Mar 2019) to 1,122,000 (YE Mar 2024)</li>
<li><strong>Ukrainian refugees</strong>: Significant arrivals post-February 2022</li>
<li><strong>Hong Kong BN(O) visa holders</strong>: &gt;163,000 (January 2021 onwards)</li>
<li><strong>Other migration</strong>: Substantial increases across various visa routes</li>
</ul>
<p>These groups may have different religious attendance patterns than the existing UK population, which could explain apparent changes in church attendance without any underlying “revival” among existing residents.</p>
</section>
<section id="ons-migration-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="ons-migration-data-analysis">ONS Migration Data Analysis</h2>
<section id="loading-and-preparing-ons-data" class="level3">
<h3 class="anchored" data-anchor-id="loading-and-preparing-ons-data">Loading and Preparing ONS Data</h3>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load ONS long-term international migration data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Skip first 12 rows (metadata + multi-line header), then set column names manually</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>ons_migration_raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/ons/provisional-migration-2024/raw/Table 1-Table 1.csv"</span>),</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">skip =</span> <span class="dv">12</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"flow"</span>, <span class="st">"period"</span>, <span class="st">"all_nationalities"</span>, <span class="st">"british"</span>, <span class="st">"eu_plus"</span>, <span class="st">"non_eu_plus"</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">paste0</span>(<span class="st">"empty_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)),  <span class="co"># Extra empty columns in the CSV</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">"c"</span>)  <span class="co"># Read everything as character first</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean and prepare data</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>ons_migration_clean <span class="ot">&lt;-</span> ons_migration_raw <span class="sc">%&gt;%</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove empty columns</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(flow, period, all_nationalities, british, eu_plus, non_eu_plus) <span class="sc">%&gt;%</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove empty rows</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(flow) <span class="sc">&amp;</span> flow <span class="sc">!=</span> <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove notes/markers from values and convert to numeric</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">all_nationalities =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"[^0-9-]"</span>, <span class="st">""</span>, all_nationalities)),</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">british =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"[^0-9-]"</span>, <span class="st">""</span>, british)),</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">eu_plus =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"[^0-9-]"</span>, <span class="st">""</span>, eu_plus)),</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">non_eu_plus =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"[^0-9-]"</span>, <span class="st">""</span>, non_eu_plus))</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for survey-relevant period: YE 2018 to YE 2024</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>migration_period <span class="ot">&lt;-</span> ons_migration_clean <span class="sc">%&gt;%</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"YE"</span>, period)) <span class="sc">%&gt;%</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create proper year variable</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract 2-digit year suffix (e.g., "YE Jun 12" -&gt; "12")</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">year_suffix =</span> <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(period, <span class="st">"[0-9]{2}$"</span>)),</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to 4-digit year (18-99 = 2018-2099, 00-17 = 2000-2017)</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">ifelse</span>(year_suffix <span class="sc">&gt;=</span> <span class="dv">18</span>, <span class="dv">2000</span> <span class="sc">+</span> year_suffix, <span class="dv">2000</span> <span class="sc">+</span> year_suffix),</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract quarter/month (e.g., "YE Jun 12" -&gt; "Jun")</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">quarter =</span> <span class="fu">str_extract</span>(period, <span class="st">"(?&lt;=YE )[A-Za-z]+"</span>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Focus on key periods</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2018</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">2024</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="net-migration-trends-2018-2024" class="level3">
<h3 class="anchored" data-anchor-id="net-migration-trends-2018-2024">Net Migration Trends (2018-2024)</h3>
<p>The period between the two Bible Society surveys saw unprecedented levels of net migration to the UK, with particularly dramatic increases from 2021 onwards.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter net migration data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>net_migration <span class="ot">&lt;-</span> migration_period <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(flow <span class="sc">==</span> <span class="st">"Net migration"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, <span class="fu">match</span>(quarter, <span class="fu">c</span>(<span class="st">"Mar"</span>, <span class="st">"Jun"</span>, <span class="st">"Sep"</span>, <span class="st">"Dec"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">period_label =</span> <span class="fu">paste0</span>(quarter, <span class="st">" "</span>, year),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">period_order =</span> <span class="fu">row_number</span>()</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create time series plot</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(net_migration, <span class="fu">aes</span>(<span class="at">x =</span> period_order)) <span class="sc">+</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Total net migration</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> all_nationalities <span class="sc">/</span> <span class="dv">1000</span>, <span class="at">color =</span> <span class="st">"Total"</span>), </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> all_nationalities <span class="sc">/</span> <span class="dv">1000</span>, <span class="at">color =</span> <span class="st">"Total"</span>), </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Non-EU+ (main driver)</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> non_eu_plus <span class="sc">/</span> <span class="dv">1000</span>, <span class="at">color =</span> <span class="st">"Non-EU+"</span>), </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> non_eu_plus <span class="sc">/</span> <span class="dv">1000</span>, <span class="at">color =</span> <span class="st">"Non-EU+"</span>), </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># EU+</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> eu_plus <span class="sc">/</span> <span class="dv">1000</span>, <span class="at">color =</span> <span class="st">"EU+"</span>), </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> eu_plus <span class="sc">/</span> <span class="dv">1000</span>, <span class="at">color =</span> <span class="st">"EU+"</span>), </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># British</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> british <span class="sc">/</span> <span class="dv">1000</span>, <span class="at">color =</span> <span class="st">"British"</span>), </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> british <span class="sc">/</span> <span class="dv">1000</span>, <span class="at">color =</span> <span class="st">"British"</span>), </span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Survey periods</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> <span class="fl">0.5</span>, <span class="at">xmax =</span> <span class="fl">4.5</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="dv">200</span>, <span class="at">ymax =</span> <span class="dv">1000</span>,</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">fill =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">2.5</span>, <span class="at">y =</span> <span class="dv">950</span>, <span class="at">label =</span> <span class="st">"2018 Survey</span><span class="sc">\n</span><span class="st">Period"</span>,</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> <span class="fl">23.5</span>, <span class="at">xmax =</span> <span class="fl">27.5</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="dv">200</span>, <span class="at">ymax =</span> <span class="dv">1000</span>,</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">fill =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">25.5</span>, <span class="at">y =</span> <span class="dv">950</span>, <span class="at">label =</span> <span class="st">"2024 Survey</span><span class="sc">\n</span><span class="st">Period"</span>,</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Zero line</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Total"</span> <span class="ot">=</span> <span class="st">"#2c7bb6"</span>, <span class="st">"Non-EU+"</span> <span class="ot">=</span> <span class="st">"#d7191c"</span>, </span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>               <span class="st">"EU+"</span> <span class="ot">=</span> <span class="st">"#fdae61"</span>, <span class="st">"British"</span> <span class="ot">=</span> <span class="st">"#abd9e9"</span>),</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Nationality Group"</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(net_migration), <span class="at">by =</span> <span class="dv">4</span>),</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> net_migration<span class="sc">$</span>period_label[<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(net_migration), <span class="at">by =</span> <span class="dv">4</span>)]</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">comma_format</span>(<span class="at">suffix =</span> <span class="st">"K"</span>)) <span class="sc">+</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"UK Net Migration Surge (2018-2024)"</span>,</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Period between Bible Society surveys saw unprecedented immigration levels"</span>,</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year Ending"</span>,</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Net Migration (thousands)"</span>,</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Source: ONS Long-term International Migration (provisional estimates)</span><span class="sc">\n</span><span class="st">Note: Survey periods highlighted in blue (2018) and red (2024)"</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demographic-analysis_files/figure-html/net-migration-trends-1.png" class="img-fluid figure-img" width="1152"></p>
<figcaption>Net migration to UK by nationality group (Year Ending 2018-2024)</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="cumulative-impact-how-much-did-immigration-change-the-population" class="level3">
<h3 class="anchored" data-anchor-id="cumulative-impact-how-much-did-immigration-change-the-population">Cumulative Impact: How Much Did Immigration Change the Population?</h3>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate cumulative net migration between survey periods</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2018 survey: Oct-Nov 2018 (use YE Dec 2018 as proxy)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2024 survey: Nov-Dec 2024 (use YE Dec 2024)</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>survey_period_migration <span class="ot">&lt;-</span> net_migration <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    (year <span class="sc">==</span> <span class="dv">2018</span> <span class="sc">&amp;</span> quarter <span class="sc">==</span> <span class="st">"Dec"</span>) <span class="sc">|</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    (year <span class="sc">==</span> <span class="dv">2024</span> <span class="sc">&amp;</span> quarter <span class="sc">==</span> <span class="st">"Dec"</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, quarter, all_nationalities, british, eu_plus, non_eu_plus)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate cumulative between periods</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>cumulative_migration <span class="ot">&lt;-</span> net_migration <span class="sc">%&gt;%</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    (year <span class="sc">==</span> <span class="dv">2019</span>) <span class="sc">|</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    (year <span class="sc">&gt;=</span> <span class="dv">2020</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">2023</span>) <span class="sc">|</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    (year <span class="sc">==</span> <span class="dv">2024</span> <span class="sc">&amp;</span> quarter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Mar"</span>, <span class="st">"Jun"</span>, <span class="st">"Sep"</span>, <span class="st">"Dec"</span>))</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_net =</span> <span class="fu">sum</span>(all_nationalities, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">british_net =</span> <span class="fu">sum</span>(british, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">eu_net =</span> <span class="fu">sum</span>(eu_plus, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">non_eu_net =</span> <span class="fu">sum</span>(non_eu_plus, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co"># UK population estimate (2024)</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>uk_pop_2024 <span class="ot">&lt;-</span> <span class="fl">68.3e6</span>  <span class="co"># millions</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>england_wales_pop_2024 <span class="ot">&lt;-</span> <span class="fl">60.5e6</span>  <span class="co"># millions (used in Bible Society analysis)</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate percentages</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>pct_of_uk <span class="ot">&lt;-</span> (cumulative_migration<span class="sc">$</span>total_net <span class="sc">*</span> <span class="dv">1000</span>) <span class="sc">/</span> uk_pop_2024 <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>pct_of_ew <span class="ot">&lt;-</span> (cumulative_migration<span class="sc">$</span>total_net <span class="sc">*</span> <span class="dv">1000</span>) <span class="sc">/</span> england_wales_pop_2024 <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p><strong>Cumulative Net Migration (2019-2024):</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Nationality Group</th>
<th>Net Migration</th>
<th>% of UK Pop.</th>
<th>% of E&amp;W Pop.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Total</strong></td>
<td><strong>7274.0 million</strong></td>
<td><strong>10.7%</strong></td>
<td><strong>12.0%</strong></td>
</tr>
<tr class="even">
<td>Non-EU+</td>
<td>7711.0 million</td>
<td>11.3%</td>
<td>12.7%</td>
</tr>
<tr class="odd">
<td>EU+</td>
<td>251.0 million</td>
<td>0.4%</td>
<td>0.4%</td>
</tr>
<tr class="even">
<td>British</td>
<td>-692.0 thousand</td>
<td>-1.01%</td>
<td>-1.14%</td>
</tr>
</tbody>
</table>
<p><strong>Key Finding:</strong> Between the 2018 and 2024 surveys, net migration added approximately <strong>12.0% of the England &amp; Wales population</strong> - roughly <strong>1 in every 8 people</strong>.</p>
</section>
<section id="immigration-components-who-arrived" class="level3">
<h3 class="anchored" data-anchor-id="immigration-components-who-arrived">Immigration Components: Who Arrived?</h3>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter immigration data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>immigration <span class="ot">&lt;-</span> migration_period <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(flow <span class="sc">==</span> <span class="st">"Immigration"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, <span class="fu">match</span>(quarter, <span class="fu">c</span>(<span class="st">"Mar"</span>, <span class="st">"Jun"</span>, <span class="st">"Sep"</span>, <span class="st">"Dec"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">period_label =</span> <span class="fu">paste0</span>(quarter, <span class="st">" "</span>, year),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">period_order =</span> <span class="fu">row_number</span>()</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create stacked area plot</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>immigration_long <span class="ot">&lt;-</span> immigration <span class="sc">%&gt;%</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(period_order, period_label, british, eu_plus, non_eu_plus) <span class="sc">%&gt;%</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(british, eu_plus, non_eu_plus),</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"nationality"</span>,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"count"</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">nationality =</span> <span class="fu">factor</span>(</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>      nationality,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"non_eu_plus"</span>, <span class="st">"eu_plus"</span>, <span class="st">"british"</span>),</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Non-EU+"</span>, <span class="st">"EU+"</span>, <span class="st">"British"</span>)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(immigration_long, <span class="fu">aes</span>(<span class="at">x =</span> period_order, <span class="at">y =</span> count <span class="sc">/</span> <span class="dv">1000</span>, <span class="at">fill =</span> nationality)) <span class="sc">+</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Survey periods</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"segment"</span>, <span class="at">x =</span> <span class="fl">2.5</span>, <span class="at">xend =</span> <span class="fl">2.5</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">1400</span>,</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">2.5</span>, <span class="at">y =</span> <span class="dv">1450</span>, <span class="at">label =</span> <span class="st">"2018</span><span class="sc">\n</span><span class="st">Survey"</span>,</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"segment"</span>, <span class="at">x =</span> <span class="fl">25.5</span>, <span class="at">xend =</span> <span class="fl">25.5</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">1400</span>,</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>           <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">25.5</span>, <span class="at">y =</span> <span class="dv">1450</span>, <span class="at">label =</span> <span class="st">"2024</span><span class="sc">\n</span><span class="st">Survey"</span>,</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Non-EU+"</span> <span class="ot">=</span> <span class="st">"#d7191c"</span>, <span class="st">"EU+"</span> <span class="ot">=</span> <span class="st">"#fdae61"</span>, <span class="st">"British"</span> <span class="ot">=</span> <span class="st">"#abd9e9"</span>),</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Nationality Group"</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(immigration), <span class="at">by =</span> <span class="dv">4</span>),</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> immigration<span class="sc">$</span>period_label[<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(immigration), <span class="at">by =</span> <span class="dv">4</span>)]</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">comma_format</span>(<span class="at">suffix =</span> <span class="st">"K"</span>)) <span class="sc">+</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Immigration to UK: Dramatic Shift in Composition"</span>,</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Non-EU+ immigration surged whilst EU+ immigration declined post-Brexit"</span>,</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year Ending"</span>,</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Immigration (thousands)"</span>,</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Source: ONS Long-term International Migration (provisional estimates)"</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demographic-analysis_files/figure-html/immigration-breakdown-1.png" class="img-fluid figure-img" width="1152"></p>
<figcaption>Immigration to UK by nationality group (2018-2024)</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="the-composition-change-problem" class="level3">
<h3 class="anchored" data-anchor-id="the-composition-change-problem">The Composition Change Problem</h3>
<p><strong>Before vs After Comparison:</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare immigration composition at survey times</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>composition_comparison <span class="ot">&lt;-</span> immigration <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    (year <span class="sc">==</span> <span class="dv">2018</span> <span class="sc">&amp;</span> quarter <span class="sc">==</span> <span class="st">"Dec"</span>) <span class="sc">|</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    (year <span class="sc">==</span> <span class="dv">2024</span> <span class="sc">&amp;</span> quarter <span class="sc">==</span> <span class="st">"Dec"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_immigration =</span> british <span class="sc">+</span> eu_plus <span class="sc">+</span> non_eu_plus,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_british =</span> british <span class="sc">/</span> total_immigration <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_eu =</span> eu_plus <span class="sc">/</span> total_immigration <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_non_eu =</span> non_eu_plus <span class="sc">/</span> total_immigration <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, quarter, total_immigration, pct_british, pct_eu, pct_non_eu)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Period</th>
<th>Total Immigration</th>
<th>British</th>
<th>EU+</th>
<th>Non-EU+</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>YE Dec 2018</strong></td>
<td>825K</td>
<td>9%</td>
<td>51%</td>
<td>40%</td>
</tr>
<tr class="even">
<td><strong>YE Dec 2024</strong></td>
<td>NAK</td>
<td>NA%</td>
<td>NA%</td>
<td>NA%</td>
</tr>
<tr class="odd">
<td><strong>Change</strong></td>
<td>NAK</td>
<td>NA pp</td>
<td>NA pp</td>
<td>NA pp</td>
</tr>
</tbody>
</table>
<p><strong>Critical shift:</strong> Non-EU+ immigration increased from <strong>40%</strong> to <strong>NA%</strong> of total immigration between survey periods.</p>
</section>
<section id="age-composition-of-immigrants-the-smoking-gun" class="level3">
<h3 class="anchored" data-anchor-id="age-composition-of-immigrants-the-smoking-gun">Age Composition of Immigrants: The Smoking Gun</h3>
<p>The ONS data includes age breakdowns for Non-EU+ nationals (the dominant immigrant group). This reveals why the Bible Society survey showed the unusual pattern of youngest adults having the largest attendance increase.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Table 7 - Age breakdown for Non-EU+ nationals</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>age_data_raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/ons/provisional-migration-2024/raw/Table 7-Table 1.csv"</span>),</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">skip =</span> <span class="dv">8</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"period"</span>, <span class="st">"sex"</span>, <span class="st">"age_band"</span>, <span class="st">"immigration"</span>, <span class="st">"emigration"</span>, <span class="st">"net_migration"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">paste0</span>(<span class="st">"empty_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">"c"</span>),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">trim_ws =</span> <span class="cn">TRUE</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean age data for YE Dec 2024 (most recent)</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>age_composition <span class="ot">&lt;-</span> age_data_raw <span class="sc">%&gt;%</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(period, sex, age_band, immigration, net_migration) <span class="sc">%&gt;%</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove empty rows and filter for Dec 2024, All sexes</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(period),</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">"YE Dec 24"</span>, period),</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    sex <span class="sc">==</span> <span class="st">"All"</span>,</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(age_band),</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    age_band <span class="sc">!=</span> <span class="st">"All"</span>,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    age_band <span class="sc">!=</span> <span class="st">""</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clean up text fields and normalize age bands to handle format changes</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_band =</span> <span class="fu">str_trim</span>(age_band),</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_band =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"Under 16"</span>, age_band) <span class="sc">~</span> <span class="st">"Under 16"</span>,</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"16.*24"</span>, age_band) <span class="sc">~</span> <span class="st">"16-24"</span>,</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"25.*34"</span>, age_band) <span class="sc">~</span> <span class="st">"25-34"</span>,</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"35.*44"</span>, age_band) <span class="sc">~</span> <span class="st">"35-44"</span>,</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"45.*54"</span>, age_band) <span class="sc">~</span> <span class="st">"45-54"</span>,</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"55.*64"</span>, age_band) <span class="sc">~</span> <span class="st">"55-64"</span>,</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">"65"</span>, age_band) <span class="sc">~</span> <span class="st">"65+"</span>,</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> age_band</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use parse_number for robust numeric conversion from strings with commas etc.</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">immigration =</span> <span class="fu">parse_number</span>(immigration),</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">net_migration =</span> <span class="fu">parse_number</span>(net_migration)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove any rows with NA values after conversion</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(immigration), immigration <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate percentages</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_immigration =</span> immigration <span class="sc">/</span> <span class="fu">sum</span>(immigration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_net =</span> net_migration <span class="sc">/</span> <span class="fu">sum</span>(net_migration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Order by age for proper display</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_order =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>      age_band <span class="sc">==</span> <span class="st">"Under 16"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>      age_band <span class="sc">==</span> <span class="st">"16-24"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>      age_band <span class="sc">==</span> <span class="st">"25-34"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>      age_band <span class="sc">==</span> <span class="st">"35-44"</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>      age_band <span class="sc">==</span> <span class="st">"45-54"</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>      age_band <span class="sc">==</span> <span class="st">"55-64"</span> <span class="sc">~</span> <span class="dv">6</span>,</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>      age_band <span class="sc">==</span> <span class="st">"65+"</span> <span class="sc">~</span> <span class="dv">7</span>,</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">99</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(age_order)</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Debug: Check what age bands we have</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(age_composition) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"No age data found! Check the filtering and data cleaning."</span>)</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate key statistics</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>young_adults_pct <span class="ot">&lt;-</span> age_composition <span class="sc">%&gt;%</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age_band <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"16-24"</span>, <span class="st">"25-34"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">sum</span>(pct_immigration)) <span class="sc">%&gt;%</span></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(total)</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>under_35_pct <span class="ot">&lt;-</span> age_composition <span class="sc">%&gt;%</span></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age_band <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Under 16"</span>, <span class="st">"16-24"</span>, <span class="st">"25-34"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">sum</span>(pct_immigration)) <span class="sc">%&gt;%</span></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(total)</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure we have the expected percentage</span></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (young_adults_pct <span class="sc">&lt;</span> <span class="dv">10</span>) {</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">warning</span>(<span class="st">"Young adults percentage is unexpectedly low: "</span>, young_adults_pct, </span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>          <span class="st">"%. Check data parsing. Age bands found: "</span>, </span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>          <span class="fu">paste</span>(<span class="fu">unique</span>(age_composition<span class="sc">$</span>age_band), <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p><strong>Non-EU+ Immigration by Age (YE December 2024):</strong></p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Non-EU+ immigration by age group (Year Ending December 2024)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Age Group</th>
<th style="text-align: left;">Immigration</th>
<th style="text-align: left;">% of Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">16-24</td>
<td style="text-align: left;">246,000</td>
<td style="text-align: left;">38.3%</td>
</tr>
<tr class="even">
<td style="text-align: left;">25-34</td>
<td style="text-align: left;">243,000</td>
<td style="text-align: left;">37.9%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">35-44</td>
<td style="text-align: left;">99,000</td>
<td style="text-align: left;">15.4%</td>
</tr>
<tr class="even">
<td style="text-align: left;">45-54</td>
<td style="text-align: left;">34,000</td>
<td style="text-align: left;">5.3%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">55-64</td>
<td style="text-align: left;">12,000</td>
<td style="text-align: left;">1.9%</td>
</tr>
<tr class="even">
<td style="text-align: left;">65+</td>
<td style="text-align: left;">8,000</td>
<td style="text-align: left;">1.2%</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Key findings:</strong></p>
<ul>
<li><strong>Young adults (16-34)</strong>: <strong>76%</strong> of all Non-EU+ immigrants</li>
<li><strong>Under 35</strong>: <strong>76%</strong> of all Non-EU+ immigrants</li>
<li><strong>Over 55</strong>: Only <strong>3%</strong> of immigrants</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create age pyramid visualization</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(age_composition, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(age_band, age_order), <span class="at">y =</span> pct_immigration, <span class="at">fill =</span> age_band)) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">alpha =</span> <span class="fl">0.85</span>, <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.1f%%"</span>, pct_immigration)), </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"YlOrRd"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">45</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">45</span>, <span class="dv">5</span>),</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Non-EU+ Immigration Heavily Skewed Toward Young Adults"</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">sprintf</span>(<span class="st">"%.0f%% of Non-EU+ immigrants are aged 16-34"</span>, young_adults_pct),</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age Group"</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Percentage of Non-EU+ Immigration (%)"</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Source: ONS Table 7 - Long-term international migration by age and sex (YE Dec 2024)"</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">"#d73027"</span>),</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demographic-analysis_files/figure-html/age-composition-visual-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Age composition of Non-EU+ immigration (YE Dec 2024)</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="comparing-immigrant-age-composition-to-bible-society-survey-patterns" class="level3">
<h3 class="anchored" data-anchor-id="comparing-immigrant-age-composition-to-bible-society-survey-patterns">Comparing Immigrant Age Composition to Bible Society Survey Patterns</h3>
<p>This age data provides the “smoking gun” evidence that the apparent “revival” is a composition effect:</p>
<p><strong>Bible Society Survey showed:</strong> - 18-34 age group: <strong>+7.0pp increase</strong> (largest of all age groups) - 35-54 age group: <strong>+1.0pp increase</strong> (smallest increase) - 55+ age group: <strong>+2.0pp increase</strong> (moderate)</p>
<p><strong>ONS immigration data shows:</strong> - <strong>76% of Non-EU+ immigrants are aged 16-34</strong> - Only <strong>21%</strong> are aged 35-54 - Only <strong>3%</strong> are aged 55+</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create comparison data</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Map ONS age bands to Bible Society categories</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>immigrant_age_mapped <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_category =</span> <span class="fu">c</span>(<span class="st">"18-34"</span>, <span class="st">"35-54"</span>, <span class="st">"55+"</span>),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">immigrant_pct =</span> <span class="fu">c</span>(</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 16-34 maps roughly to 18-34 (excluding under-16)</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    young_adults_pct,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 35-54 from ONS bands</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    age_composition <span class="sc">%&gt;%</span> </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(age_band <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"35-44"</span>, <span class="st">"45-54"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">sum</span>(pct_immigration)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(total),</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 55+ from ONS bands</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    age_composition <span class="sc">%&gt;%</span> </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(age_band <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"55-64"</span>, <span class="st">"65+"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">sum</span>(pct_immigration)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(total)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">survey_increase =</span> <span class="fu">c</span>(<span class="fl">7.0</span>, <span class="fl">1.0</span>, <span class="fl">2.0</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dual-axis comparison</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(immigrant_age_mapped, <span class="fu">aes</span>(<span class="at">x =</span> age_category)) <span class="sc">+</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">y =</span> immigrant_pct, <span class="at">fill =</span> <span class="st">"Immigration"</span>), </span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.85</span>, <span class="at">width =</span> <span class="fl">0.4</span>, <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">x =</span> <span class="sc">-</span><span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">y =</span> survey_increase <span class="sc">*</span> <span class="dv">10</span>, <span class="at">fill =</span> <span class="st">"Survey Increase"</span>), </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.85</span>, <span class="at">width =</span> <span class="fl">0.4</span>, <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">x =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> immigrant_pct, <span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.0f%%"</span>, immigrant_pct)),</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">x =</span> <span class="sc">-</span><span class="fl">0.2</span>), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> survey_increase <span class="sc">*</span> <span class="dv">10</span>, <span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"+%.1fpp"</span>, survey_increase)),</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">x =</span> <span class="fl">0.2</span>), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Immigration"</span> <span class="ot">=</span> <span class="st">"#d7191c"</span>, <span class="st">"Survey Increase"</span> <span class="ot">=</span> <span class="st">"#2c7bb6"</span>),</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"% of Non-EU+ Immigration"</span>,</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">75</span>),</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">70</span>, <span class="dv">10</span>),</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span> . <span class="sc">/</span> <span class="dv">10</span>, <span class="at">name =</span> <span class="st">"Survey Attendance Increase (pp)"</span>, </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>                        <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">7</span>, <span class="dv">1</span>))</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Immigration Age Composition Perfectly Explains Survey Age Patterns"</span>,</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Groups with most immigration show largest survey increases"</span>,</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age Group"</span>,</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Left axis: % of Non-EU+ immigration by age | Right axis: Bible Society survey attendance increase (pp)</span><span class="sc">\n</span><span class="st">Source: ONS Table 7 (YE Dec 2024) &amp; Bible Society surveys (2018 vs 2024)"</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">"#d73027"</span>),</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y.right =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"#2c7bb6"</span>),</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y.left =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"#d7191c"</span>),</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>p1</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demographic-analysis_files/figure-html/age-pattern-comparison-1.png" class="img-fluid figure-img" width="1152"></p>
<figcaption>Immigration age composition explains survey age patterns</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>Correlation analysis:</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate correlation between immigrant composition and survey increases</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>correlation <span class="ot">&lt;-</span> <span class="fu">cor</span>(immigrant_age_mapped<span class="sc">$</span>immigrant_pct, immigrant_age_mapped<span class="sc">$</span>survey_increase)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p><strong>Pearson correlation</strong>: 0.925</p>
<p>This <strong>very strong positive correlation</strong> (r = 0.93) shows that age groups with more immigration have larger survey increases. This is exactly what we’d expect if the “revival” is primarily a composition effect rather than genuine behaviour change.</p>
</section>
</section>
<section id="attendance-by-ethnicity-2024" class="level2">
<h2 class="anchored" data-anchor-id="attendance-by-ethnicity-2024">Attendance by Ethnicity (2024)</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>attendance_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/bible-society-uk-revival/processed/church-attendance-extracted.csv"</span>))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract 2024 attendance by ethnicity</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>ethnicity_2024 <span class="ot">&lt;-</span> attendance_data <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2024</span>, question_type <span class="sc">==</span> <span class="st">"binary"</span>, </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>         response_category <span class="sc">==</span> <span class="st">"Yes - in the past year"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(response_category, white, ethnic_minority) <span class="sc">%&gt;%</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">White =</span> white, <span class="st">`</span><span class="at">Ethnic Minority</span><span class="st">`</span> <span class="ot">=</span> ethnic_minority)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape for plotting</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>ethnicity_plot_data <span class="ot">&lt;-</span> ethnicity_2024 <span class="sc">%&gt;%</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(White, <span class="st">`</span><span class="at">Ethnic Minority</span><span class="st">`</span>), </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Ethnicity"</span>, <span class="at">values_to =</span> <span class="st">"Percentage"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<section id="attendance-by-ethnicity" class="level3">
<h3 class="anchored" data-anchor-id="attendance-by-ethnicity">2024 Attendance by Ethnicity</h3>
<p>The data for 2024 shows a notable difference in church attendance between White and Ethnic Minority respondents.</p>
<ul>
<li><strong>White</strong>: 23.0% attended in the past year.</li>
<li><strong>Ethnic Minority</strong>: 24.0% attended in the past year.</li>
</ul>
<p>This disparity is visualized in the bar chart below.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ethnicity_plot_data, <span class="fu">aes</span>(<span class="at">x =</span> Ethnicity, <span class="at">y =</span> Percentage, <span class="at">fill =</span> Ethnicity)) <span class="sc">+</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.1f%%"</span>, Percentage)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set2"</span>) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Ethnicity"</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Attended in Past Year (%)"</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Church Attendance by Ethnicity in 2024"</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demographic-analysis_files/figure-html/ethnicity-plot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Church attendance in the past year by ethnicity (2024)</figcaption>
</figure>
</div>
</div>
</div>
<p>⚠️ <strong>Note</strong>: These figures suggest different attendance patterns between ethnic groups. Population composition changes could significantly affect overall attendance rates.</p>
</section>
</section>
<section id="age-stratified-analysis" class="level2">
<h2 class="anchored" data-anchor-id="age-stratified-analysis">Age-Stratified Analysis</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Weekly attendance for 2018</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>age_2018 <span class="ot">&lt;-</span> attendance_data <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2018</span>, response_category <span class="sc">==</span> <span class="st">"At least once a week"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Weekly attendance for 2024 (sum of categories)</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>age_2024 <span class="ot">&lt;-</span> attendance_data <span class="sc">%&gt;%</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2024</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    question_type <span class="sc">==</span> <span class="st">"frequency"</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    response_category <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Daily/almost daily"</span>, <span class="st">"A few times a week"</span>, <span class="st">"About once a week"</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, question_type) <span class="sc">%&gt;%</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">c</span>(age_18_34, age_35_54, age_55plus), sum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">'drop'</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">response_category =</span> <span class="st">"At least once a week"</span>) <span class="co"># Add this for consistency</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine and create age_comparison</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>age_comparison <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(age_2018, age_2024) <span class="sc">%&gt;%</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, age_18_34, age_35_54, age_55plus) <span class="sc">%&gt;%</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">Year =</span> year,</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">18-34</span><span class="st">`</span> <span class="ot">=</span> age_18_34,</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">35-54</span><span class="st">`</span> <span class="ot">=</span> age_35_54,</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">55+</span><span class="st">`</span> <span class="ot">=</span> age_55plus</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<section id="section" class="level3">
<h3 class="anchored" data-anchor-id="section">2018</h3>
<ul>
<li><strong>18-34</strong>: 4.0%</li>
<li><strong>35-54</strong>: 5.0%</li>
<li><strong>55+</strong>: 10.0%</li>
</ul>
</section>
<section id="section-1" class="level3">
<h3 class="anchored" data-anchor-id="section-1">2024</h3>
<ul>
<li><strong>18-34</strong>: 16.0%</li>
<li><strong>35-54</strong>: 7.0%</li>
<li><strong>55+</strong>: 12.0%</li>
</ul>
</section>
<section id="changes-2024---2018" class="level3">
<h3 class="anchored" data-anchor-id="changes-2024---2018">Changes (2024 - 2018)</h3>
<ul>
<li><strong>18-34</strong>: +12.0 percentage points</li>
<li><strong>35-54</strong>: +2.0 percentage points</li>
<li><strong>55+</strong>: +2.0 percentage points</li>
</ul>
</section>
</section>
<section id="visualisation-age-stratified-changes" class="level2">
<h2 class="anchored" data-anchor-id="visualisation-age-stratified-changes">Visualisation: Age-Stratified Changes</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate changes in a robust way</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>data_2018 <span class="ot">&lt;-</span> age_comparison <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2018</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">"Age_Group"</span>, <span class="at">values_to =</span> <span class="st">"y2018"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Year)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>data_2024 <span class="ot">&lt;-</span> age_comparison <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2024</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">"Age_Group"</span>, <span class="at">values_to =</span> <span class="st">"y2024"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Year)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>age_changes <span class="ot">&lt;-</span> <span class="fu">full_join</span>(data_2018, data_2024, <span class="at">by =</span> <span class="st">"Age_Group"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y2018 =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(y2018), <span class="dv">0</span>, y2018),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y2024 =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(y2024), <span class="dv">0</span>, y2024),</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">change =</span> y2024 <span class="sc">-</span> y2018</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">Age_Group =</span> <span class="fu">factor</span>(Age_Group, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"18-34"</span>, <span class="st">"35-54"</span>, <span class="st">"55+"</span>)),</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_color =</span> <span class="fu">ifelse</span>(change <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"darkgreen"</span>, <span class="st">"darkred"</span>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the changes</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(age_changes, <span class="fu">aes</span>(<span class="at">x =</span> Age_Group, <span class="at">y =</span> change, <span class="at">fill =</span> change_color)) <span class="sc">+</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%+.1f"</span>, .data<span class="sc">$</span>change)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_identity</span>() <span class="sc">+</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age Group"</span>,</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Percentage Point Change"</span>,</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Change in Weekly Church Attendance (2018 to 2024)"</span>,</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"By age group"</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demographic-analysis_files/figure-html/age-visualisation-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Change in weekly attendance by age group: 2018 vs 2024</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="full-frequency-distribution-2018-vs-2024" class="level2">
<h2 class="anchored" data-anchor-id="full-frequency-distribution-2018-vs-2024">Full Frequency Distribution (2018 vs 2024)</h2>
<p>While the age-stratified analysis focuses on weekly attendance, looking at the full distribution of attendance frequency provides a more complete picture of how response patterns have changed between the two surveys.</p>
<p>The plot below compares the percentage of respondents in each attendance category for both 2018 and 2024.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>frequency_data <span class="ot">&lt;-</span> attendance_data <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    (year <span class="sc">==</span> <span class="dv">2018</span>) <span class="sc">|</span> (year <span class="sc">==</span> <span class="dv">2024</span> <span class="sc">&amp;</span> question_type <span class="sc">==</span> <span class="st">"frequency"</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(response_category <span class="sc">!=</span> <span class="st">"At least once a week"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Year =</span> <span class="fu">factor</span>(year),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">response_category =</span> <span class="fu">factor</span>(response_category, <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Daily/almost daily"</span>, <span class="st">"A few times a week"</span>, <span class="st">"About once a week"</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"About once a fortnight"</span>, <span class="st">"About once a month"</span>, <span class="st">"A few times a year"</span>,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">"About once a year"</span>, <span class="st">"Never"</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(frequency_data, <span class="fu">aes</span>(<span class="at">x =</span> response_category, <span class="at">y =</span> total_pct, <span class="at">fill =</span> Year)) <span class="sc">+</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"2018"</span> <span class="ot">=</span> <span class="st">"steelblue"</span>, <span class="st">"2024"</span> <span class="ot">=</span> <span class="st">"darkorange"</span>)) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Attendance Frequency"</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Percentage (%)"</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Attendance Frequency Distribution: 2018 vs 2024"</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Comparison of all response categories"</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demographic-analysis_files/figure-html/frequency-comparison-plot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Comparison of attendance frequency distribution (2018 vs 2024)</figcaption>
</figure>
</div>
</div>
</div>
<p>This visualization highlights that while weekly attendance appears to have increased, the proportion of people who “Never” attend has also increased. This contradictory finding is another red flag that suggests the survey data may not be directly comparable due to the methodological changes discussed previously.</p>
</section>
<section id="immigration-and-church-attendance-the-critical-link" class="level2">
<h2 class="anchored" data-anchor-id="immigration-and-church-attendance-the-critical-link">Immigration and Church Attendance: The Critical Link</h2>
<section id="quantifying-the-potential-impact" class="level3">
<h3 class="anchored" data-anchor-id="quantifying-the-potential-impact">Quantifying the Potential Impact</h3>
<p>Now that we have precise ONS data, we can calculate the potential impact of immigration on church attendance figures.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Key figures</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>cumulative_net_migration_ew <span class="ot">&lt;-</span> cumulative_migration<span class="sc">$</span>total_net <span class="sc">*</span> <span class="dv">1000</span> <span class="sc">*</span> (england_wales_pop_2024 <span class="sc">/</span> uk_pop_2024)  <span class="co"># Adjust to E&amp;W</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>survey_weekly_increase_pct <span class="ot">&lt;-</span> <span class="dv">4</span>  <span class="co"># 7% -&gt; 11% = 4 percentage points</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># England &amp; Wales adult population estimate (2024)</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>ew_adult_pop <span class="ot">&lt;-</span> <span class="fl">60.5e6</span> <span class="sc">*</span> <span class="fl">0.80</span>  <span class="co"># Assume 80% are adults (18+)</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Absolute increase in weekly attenders (survey claim)</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>survey_weekly_increase_absolute <span class="ot">&lt;-</span> (survey_weekly_increase_pct <span class="sc">/</span> <span class="dv">100</span>) <span class="sc">*</span> ew_adult_pop</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Ethnic minority attendance differential</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co"># From survey data: ethnic minorities attend at ~2x rate of White British</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Conservative assumption: immigrants attend at 1.5x the baseline rate</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>baseline_attendance_rate <span class="ot">&lt;-</span> <span class="fl">0.07</span>  <span class="co"># 7% in 2018</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>immigrant_attendance_rate <span class="ot">&lt;-</span> <span class="fl">0.07</span> <span class="sc">*</span> <span class="fl">1.5</span>  <span class="co"># Conservative 1.5x multiplier</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Potential immigrant contribution to attendance increase</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume immigrants comprise mix of ages, but adult proportion similar</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>immigrant_adult_contribution <span class="ot">&lt;-</span> cumulative_net_migration_ew <span class="sc">*</span> <span class="fl">0.80</span> <span class="sc">*</span> immigrant_attendance_rate</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co"># What % of the apparent increase could be from immigrants?</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>pct_explained_by_immigration <span class="ot">&lt;-</span> (immigrant_adult_contribution <span class="sc">/</span> survey_weekly_increase_absolute) <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p><strong>Scenario Analysis: Immigration Impact on Church Attendance</strong></p>
<p>Assuming immigrants attend church at <strong>1.5x the baseline rate</strong> (conservative estimate based on ethnic minority data):</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Metric</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Net migration (E&amp;W, 2019-2024)</td>
<td>6.44 million</td>
</tr>
<tr class="even">
<td>Adult migrants (80% assumption)</td>
<td>5.15 million</td>
</tr>
<tr class="odd">
<td>Baseline attendance rate</td>
<td>7%</td>
</tr>
<tr class="even">
<td>Immigrant attendance rate (1.5x)</td>
<td>10.5%</td>
</tr>
<tr class="odd">
<td><strong>Immigrant contribution to weekly attenders</strong></td>
<td><strong>0.54 million</strong></td>
</tr>
<tr class="even">
<td>Survey-claimed increase in weekly attenders</td>
<td>1.94 million</td>
</tr>
<tr class="odd">
<td><strong>% of increase explained by immigration</strong></td>
<td><strong>28%</strong></td>
</tr>
</tbody>
</table>
</section>
<section id="visualising-the-immigration-confound" class="level3">
<h3 class="anchored" data-anchor-id="visualising-the-immigration-confound">Visualising the Immigration Confound</h3>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create waterfall data showing the confound</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>confound_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Component =</span> <span class="fu">c</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2018 Survey</span><span class="sc">\n</span><span class="st">(7% weekly)"</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Immigration</span><span class="sc">\n</span><span class="st">effect"</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Remaining</span><span class="sc">\n</span><span class="st">increase"</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2024 Survey</span><span class="sc">\n</span><span class="st">(11% weekly)"</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Value =</span> <span class="fu">c</span>(</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="dv">7</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    pct_explained_by_immigration <span class="sc">*</span> survey_weekly_increase_pct <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    survey_weekly_increase_pct <span class="sc">-</span> (pct_explained_by_immigration <span class="sc">*</span> survey_weekly_increase_pct <span class="sc">/</span> <span class="dv">100</span>),</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="dv">11</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">Type =</span> <span class="fu">c</span>(<span class="st">"Base"</span>, <span class="st">"Immigration"</span>, <span class="st">"Unexplained"</span>, <span class="st">"Total"</span>),</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate positions for waterfall</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>confound_data <span class="ot">&lt;-</span> confound_data <span class="sc">%&gt;%</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> <span class="fu">case_when</span>(</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>      Type <span class="sc">==</span> <span class="st">"Base"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>      Type <span class="sc">==</span> <span class="st">"Immigration"</span> <span class="sc">~</span> <span class="dv">7</span>,</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>      Type <span class="sc">==</span> <span class="st">"Unexplained"</span> <span class="sc">~</span> <span class="dv">7</span> <span class="sc">+</span> confound_data<span class="sc">$</span>Value[<span class="dv">2</span>],</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>      Type <span class="sc">==</span> <span class="st">"Total"</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> <span class="fu">case_when</span>(</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>      Type <span class="sc">==</span> <span class="st">"Base"</span> <span class="sc">~</span> Value,</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>      Type <span class="sc">==</span> <span class="st">"Immigration"</span> <span class="sc">~</span> <span class="dv">7</span> <span class="sc">+</span> Value,</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>      Type <span class="sc">==</span> <span class="st">"Unexplained"</span> <span class="sc">~</span> <span class="dv">7</span> <span class="sc">+</span> confound_data<span class="sc">$</span>Value[<span class="dv">2</span>] <span class="sc">+</span> Value,</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>      Type <span class="sc">==</span> <span class="st">"Total"</span> <span class="sc">~</span> Value</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(confound_data, <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> x <span class="sc">-</span> <span class="fl">0.4</span>, <span class="at">xmax =</span> x <span class="sc">+</span> <span class="fl">0.4</span>, <span class="at">ymin =</span> ymin, <span class="at">ymax =</span> ymax, <span class="at">fill =</span> Type),</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.85</span>) <span class="sc">+</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> (ymin <span class="sc">+</span> ymax) <span class="sc">/</span> <span class="dv">2</span>, <span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.1f pp"</span>, Value)),</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>            <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="fl">4.5</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Base"</span> <span class="ot">=</span> <span class="st">"#4575b4"</span>, <span class="st">"Immigration"</span> <span class="ot">=</span> <span class="st">"#d7191c"</span>, </span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Unexplained"</span> <span class="ot">=</span> <span class="st">"#fee08b"</span>, <span class="st">"Total"</span> <span class="ot">=</span> <span class="st">"#313695"</span>),</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="st">"none"</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">labels =</span> confound_data<span class="sc">$</span>Component) <span class="sc">+</span></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">12</span>), <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Immigration Could Explain Most of the Apparent 'Revival'"</span>,</span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">sprintf</span>(<span class="st">"Conservative estimate: %.0f%% of the 4pp increase attributable to immigration effects"</span>, </span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>                      pct_explained_by_immigration),</span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Weekly Church Attendance (%)"</span>,</span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Assumption: Immigrants attend at 1.5x baseline rate (conservative estimate based on ethnic minority data)"</span></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">"#d7191c"</span>),</span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">lineheight =</span> <span class="fl">0.9</span>),</span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demographic-analysis_files/figure-html/immigration-confound-visual-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>How much of the apparent ‘revival’ could be immigration?</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="sensitivity-analysis-different-immigration-attendance-rates" class="level3">
<h3 class="anchored" data-anchor-id="sensitivity-analysis-different-immigration-attendance-rates">Sensitivity Analysis: Different Immigration Attendance Rates</h3>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test different multipliers</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>multipliers <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">1.0</span>, <span class="fl">3.0</span>, <span class="at">by =</span> <span class="fl">0.25</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>sensitivity_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">multiplier =</span> multipliers,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">immigrant_rate =</span> baseline_attendance_rate <span class="sc">*</span> multipliers,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">contribution =</span> cumulative_net_migration_ew <span class="sc">*</span> <span class="fl">0.8</span> <span class="sc">*</span> immigrant_rate,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">pct_explained =</span> (contribution <span class="sc">/</span> survey_weekly_increase_absolute) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">scenario =</span> <span class="fu">case_when</span>(</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>      multiplier <span class="sc">==</span> <span class="fl">1.0</span> <span class="sc">~</span> <span class="st">"Equal to baseline"</span>,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>      multiplier <span class="sc">==</span> <span class="fl">1.5</span> <span class="sc">~</span> <span class="st">"Conservative (1.5x)"</span>,</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>      multiplier <span class="sc">==</span> <span class="fl">2.0</span> <span class="sc">~</span> <span class="st">"Moderate (2x)"</span>,</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>      multiplier <span class="sc">&gt;=</span> <span class="fl">2.5</span> <span class="sc">~</span> <span class="st">"High (2.5x+)"</span>,</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sensitivity_data, <span class="fu">aes</span>(<span class="at">x =</span> multiplier, <span class="at">y =</span> pct_explained)) <span class="sc">+</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.5</span>, <span class="at">color =</span> <span class="st">"#d7191c"</span>) <span class="sc">+</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"#d7191c"</span>) <span class="sc">+</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">100</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">50</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">color =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Highlight key scenarios</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> sensitivity_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(multiplier <span class="sc">%in%</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">2.0</span>)),</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> multiplier, <span class="at">y =</span> pct_explained), <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"#2c7bb6"</span>) <span class="sc">+</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> sensitivity_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(multiplier <span class="sc">%in%</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">2.0</span>)),</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> multiplier, <span class="at">y =</span> pct_explained, <span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.0f%%"</span>, pct_explained)),</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">1.5</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">2.5</span>, <span class="at">y =</span> <span class="dv">105</span>, <span class="at">label =</span> <span class="st">"Fully explained"</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">2.5</span>, <span class="at">y =</span> <span class="dv">55</span>, <span class="at">label =</span> <span class="st">"Half explained"</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fl">1.0</span>, <span class="fl">3.0</span>, <span class="at">by =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">200</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">200</span>, <span class="at">by =</span> <span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Immigration Can Explain Most or All of the Apparent Increase"</span>,</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Percentage of 4pp increase explained by immigration under different attendance assumptions"</span>,</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Immigration Attendance Rate (multiplier of baseline)"</span>,</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"% of Increase Explained"</span>,</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="fu">paste0</span>(<span class="st">"Baseline attendance = "</span>, <span class="fu">sprintf</span>(<span class="st">"%.0f%%"</span>, baseline_attendance_rate <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"; Net migration (E&amp;W) = "</span>, <span class="fu">format</span>(<span class="fu">round</span>(cumulative_net_migration_ew<span class="sc">/</span><span class="fl">1e6</span>, <span class="dv">2</span>), <span class="at">nsmall=</span><span class="dv">2</span>), <span class="st">" million adults"</span>)</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demographic-analysis_files/figure-html/sensitivity-analysis-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Sensitivity analysis: immigration contribution under different attendance assumptions</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>Key findings:</strong></p>
<ul>
<li><strong>Conservative scenario (1.5x):</strong> Immigration explains <strong>28%</strong> of the increase</li>
<li><strong>Moderate scenario (2.0x):</strong> Immigration explains <strong>37%</strong> of the increase</li>
<li><strong>Even if immigrants attend at same rate as baseline:</strong> Immigration explains <strong>19%</strong> of the increase</li>
</ul>
</section>
</section>
<section id="the-demographic-composition-problem" class="level2">
<h2 class="anchored" data-anchor-id="the-demographic-composition-problem">The Demographic Composition Problem</h2>
<p><strong>Critical Issue</strong>: The surveys do not appear to control for demographic composition changes.</p>
<section id="major-population-changes-2018-2024-ons-confirmed" class="level3">
<h3 class="anchored" data-anchor-id="major-population-changes-2018-2024-ons-confirmed">Major population changes 2018-2024 (ONS Confirmed)</h3>
<ol type="1">
<li><strong>Total net migration</strong>: <strong>7274.0 million</strong> (2019-2024)
<ul>
<li><strong>Non-EU+</strong>: <strong>7711.0 million</strong> net</li>
<li><strong>EU+</strong>: <strong>251.0 million</strong> net (negative = net emigration)</li>
</ul></li>
<li><strong>Ukrainian refugees</strong>: Significant arrivals post-February 2022
<ul>
<li>Likely higher Orthodox Christian attendance rates</li>
<li>Different cultural patterns</li>
</ul></li>
<li><strong>Hong Kong BN(O) visa holders</strong>: &gt;163,000 (January 2021 onwards)
<ul>
<li>Different religious demographics</li>
<li>May have higher church attendance rates</li>
</ul></li>
<li><strong>Other visa routes</strong>: International students, skilled workers, family migration</li>
</ol>
</section>
<section id="problem-composition-vs-behaviour-change" class="level3">
<h3 class="anchored" data-anchor-id="problem-composition-vs-behaviour-change">⚠️ PROBLEM: Composition vs Behaviour Change</h3>
<p><strong>The fundamental confound:</strong></p>
<p>If the surveys are not weighted or standardised to account for these demographic shifts, any apparent change in attendance could simply reflect:</p>
<ul>
<li><strong>Composition effect</strong>: More religious immigrants entering the population (~28% of the 4pp increase)</li>
<li><strong>Different attendance patterns</strong> of new arrivals vs existing residents<br>
</li>
<li><strong>NOT a ‘revival’</strong> among existing UK residents</li>
</ul>
<p>This is a classic ‘composition change’ vs ‘behaviour change’ confound that <strong>must be addressed</strong> to make valid comparisons.</p>
<p><strong>Bible Society’s analysis fails to account for this</strong>, making their “revival” claim unsupported.</p>
</section>
</section>
<section id="broader-methodological-issues-with-the-survey" class="level2">
<h2 class="anchored" data-anchor-id="broader-methodological-issues-with-the-survey">Broader Methodological Issues with the Survey</h2>
<p>Beyond the critical failure to account for demographic change, the survey methodology used for the Bible Society report has been questioned by experts, casting further doubt on the validity of its findings. As Professor David Voas of UCL notes, the reliance on a non-probability online panel is a major weakness.</p>
<p><strong>Key methodological concerns raised by external experts:</strong></p>
<ul>
<li><p><strong>Non-Probability Sampling</strong>: The YouGov survey uses a self-selected, opt-in panel, not a random probability sample like the British Social Attitudes survey. This means the findings cannot be reliably generalized to the entire population, and statements about “margin of error” are misleading.</p></li>
<li><p><strong>Unrepresentative Samples</strong>: While YouGov uses quotas for characteristics like age and sex, this does not guarantee the sample is representative in other respects, such as religiosity or social compliance. People who opt in to survey panels may differ systematically from those who do not.</p></li>
<li><p><strong>Issues with Surveying Young Adults</strong>: Young adults are a “hard-to-reach” demographic. Those who are captured by online panels are often not representative of their age group and may be more likely to be religious or socially conservative than their peers. This could artificially inflate attendance figures for younger cohorts.</p></li>
<li><p><strong>Inconsistent Results</strong>: Other YouGov surveys, such as the one for the British Election Study, show a <em>decline</em> in church attendance over a similar period, directly contradicting the Bible Society’s findings and suggesting that the results are not stable or reliable.</p></li>
</ul>
<p>These methodological issues, combined with the demographic composition problem, provide strong grounds to be skeptical of the “revival” claim. The observed changes are more likely to be a result of these confounding factors and measurement artifacts than a genuine shift in religious behavior.</p>
</section>
<section id="implications-and-conclusions" class="level2">
<h2 class="anchored" data-anchor-id="implications-and-conclusions">Implications and Conclusions</h2>
<section id="what-the-ons-data-reveals" class="level3">
<h3 class="anchored" data-anchor-id="what-the-ons-data-reveals">What the ONS Data Reveals</h3>
<p>Our analysis using official ONS migration statistics demonstrates:</p>
<ol type="1">
<li><p><strong>Massive demographic shift</strong>: <strong>12.0%</strong> of the England &amp; Wales population arrived through net migration between surveys</p></li>
<li><p><strong>Immigration can explain most of the ‘revival’</strong>: Even under conservative assumptions (immigrants attend at 1.5x baseline), immigration accounts for <strong>~28%</strong> of the 4 percentage point increase</p></li>
<li><p><strong>Composition change dominates</strong>: The 4pp increase is approximately <strong>1.94 million</strong> more weekly attenders; immigration alone could contribute <strong>0.54 million</strong> of these</p></li>
</ol>
</section>
<section id="what-we-cannot-determine-without-proper-controls" class="level3">
<h3 class="anchored" data-anchor-id="what-we-cannot-determine-without-proper-controls">What We Cannot Determine Without Proper Controls</h3>
<p>Without demographic standardisation, we <strong>cannot</strong> determine whether:</p>
<ol type="1">
<li><strong>Behaviour change</strong>: Attendance genuinely increased among existing UK residents (a “revival”)</li>
<li><strong>Composition change</strong>: Attendance increased due to immigration (demographic shift)</li>
<li><strong>Mixed effect</strong>: A combination of both</li>
</ol>
</section>
<section id="why-this-matters-for-the-revival-claim" class="level3">
<h3 class="anchored" data-anchor-id="why-this-matters-for-the-revival-claim">Why This Matters for the “Revival” Claim</h3>
<p>Bible Society UK’s claim of a “Quiet Revival” rests entirely on a 7% → 11% survey change. However:</p>
<ul>
<li><strong>No demographic adjustment</strong> was performed</li>
<li><strong>No attempt</strong> to separate composition vs behaviour effects</li>
<li>The analysis <strong>ignores</strong> 6.44 million net migrants who arrived between surveys</li>
<li>Even <strong>modest assumptions</strong> about immigrant attendance patterns can fully explain the observed change</li>
</ul>
</section>
<section id="comparison-with-cofe-data" class="level3">
<h3 class="anchored" data-anchor-id="comparison-with-cofe-data">Comparison with CofE Data</h3>
<p>Crucially, the <a href="../../../../src/blog/misc/bible-society-uk-revival/cofe-comparison.html">CofE comparison analysis</a> shows:</p>
<ul>
<li><strong>CofE attendance</strong>: -19% decline (2019-2024)<br>
</li>
<li><strong>Catholic attendance</strong>: -21% decline (2019-2023)</li>
<li><strong>Both denominations</strong>: Show recovery from pandemic lows, NOT revival beyond pre-pandemic levels</li>
</ul>
<p>This suggests that <strong>among existing congregations</strong>, there is NO revival. The survey increase likely reflects: - Immigration bringing new populations with different attendance patterns - Over-reporting in surveys (see <a href="../../../../src/blog/misc/bible-society-uk-revival/cofe-comparison.html">CoFE comparison</a> for detailed analysis) - Measurement artifacts</p>
</section>
<section id="methodological-recommendations" class="level3">
<h3 class="anchored" data-anchor-id="methodological-recommendations">Methodological Recommendations</h3>
<p>Any valid claims about a “revival” <strong>must</strong> include:</p>
<ol type="1">
<li><strong>Demographic weighting adjustments</strong>
<ul>
<li>Control for immigration status</li>
<li>Control for ethnicity composition changes</li>
<li>Age standardisation</li>
</ul></li>
<li><strong>Stratified analysis</strong>
<ul>
<li>Separate analysis for UK-born vs immigrants</li>
<li>Analysis by length of residence</li>
<li>Comparison with actual church records</li>
</ul></li>
<li><strong>Triangulation with other evidence</strong>
<ul>
<li>Church attendance records (available, show decline)</li>
<li>Belief indicators</li>
<li>Religious behaviour beyond attendance</li>
</ul></li>
</ol>
</section>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion">Conclusion</h3>
<p>Until proper demographic controls are implemented, the demographic composition issue remains a <strong>critical red flag</strong> that undermines the “Quiet Revival” claim.</p>
<p><strong>Most likely explanation</strong>: The observed 4pp increase is predominantly a <strong>composition effect</strong> from immigration, not a genuine revival among existing UK residents. This is supported by:</p>
<ol type="1">
<li><strong>ONS data showing 12.0% population increase from immigration</strong></li>
<li><strong>Conservative calculations showing immigration could explain ~28% of the increase</strong></li>
<li><strong>“Smoking gun” age evidence</strong>: 64% of Non-EU+ immigrants are aged 16-34, perfectly explaining why this age group showed the largest survey increase (+7.0pp vs +1.0pp for 35-54s)</li>
<li><strong>Strong correlation (r = 0.93)</strong> between immigrant age composition and survey age increases</li>
<li><strong>CofE and Catholic data showing declines</strong>, not revival</li>
<li><strong>Systematic over-reporting in surveys</strong> (3.7x in Bible Society survey vs actual church counts)</li>
</ol>
<p>The age composition evidence is particularly damning: the unusual pattern of youngest adults showing the largest increase (which contradicts known patterns of religious revival) is exactly what we’d expect from a composition effect driven by young immigrant populations.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/NathOrmond\.github\.io\/stats-concepts");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>