---
title: "General Overview"
subtitle: "Comprehensive comparison of 2018 and 2024 survey responses"
execute:
  echo: true
  warning: false
  message: false
---

```{r}
#| label: setup
#| include: false

# Set working directory to project root using here package
if (!require(here, quietly = TRUE)) {
  install.packages("here")
}
# Find project root (directory containing _quarto.yml)
here::i_am("_quarto.yml")
# Set working directory to project root
setwd(here())

# Load required packages
library(tidyverse)
library(scales)
library(ggplot2)
library(knitr)
library(patchwork)

# Set seed for reproducibility
set.seed(123)

# Custom theme
theme_comparison <- function() {
  theme_minimal(base_size = 12) +
    theme(
      plot.title = element_text(face = "bold", size = 14),
      plot.subtitle = element_text(size = 11, color = "grey40"),
      legend.position = "top",
      panel.grid.minor = element_blank()
    )
}
```

## Introduction

This document provides a comprehensive, descriptive comparison of all survey questions common to both the 2018 and 2024 YouGov surveys on church attendance in the UK. The focus here is on presenting the data clearly , showing what was asked and how responses differed between the two time points.

## Survey Metadata

```{r}
#| label: load-metadata

# Load survey metadata
survey_meta <- read_csv(here::here("data/bible-society-uk-revival/processed/survey-metadata.csv"), 
                        comment = "#")
```

::: {style="overflow-x: auto; overflow-y: auto; max-height: 400px; border: 1px solid #ddd; padding: 10px; margin-bottom: 20px;"}

```{r}
#| echo: false

kable(survey_meta, caption = "Survey metadata for 2018 and 2024")
```

:::

### Key Survey Characteristics

```{r}
#| label: survey-characteristics-table

characteristics <- tibble(
  Characteristic = c(
    "Survey Organisation",
    "Survey Type",
    "Fieldwork Period",
    "Sample Size (Unweighted)",
    "Sample Size (Weighted)",
    "Primary Question Topic"
  ),
  `2018` = c(
    "YouGov",
    "Online panel",
    "11 Oct - 13 Nov 2018",
    format(survey_meta$sample_size_unweighted[1], big.mark = ","),
    format(survey_meta$sample_size_weighted[1], big.mark = ","),
    "Church attendance frequency"
  ),
  `2024` = c(
    "YouGov",
    "Online panel",
    "4 Nov - 2 Dec 2024",
    format(survey_meta$sample_size_unweighted[2], big.mark = ","),
    format(survey_meta$sample_size_weighted[2], big.mark = ","),
    "Church attendance (binary + frequency)"
  )
)

kable(characteristics, caption = "Survey characteristics comparison")
```

**Note**: The 2024 survey has `r sprintf("%.1f", (1 - survey_meta$sample_size_weighted[2] / survey_meta$sample_size_weighted[1]) * 100)`% fewer respondents than 2018.

### Sample Size and Statistical Precision

```{r}
#| label: sample-size-precision
#| echo: false

# Calculate margins of error for both surveys
n_2018 <- survey_meta$sample_size_weighted[1]
n_2024 <- survey_meta$sample_size_weighted[2]

# Calculate margin of error for 50% proportion (worst case scenario) at 95% confidence
moe_2018 <- 1.96 * sqrt(0.5 * 0.5 / n_2018) * 100
moe_2024 <- 1.96 * sqrt(0.5 * 0.5 / n_2024) * 100

# Calculate effective sample sizes assuming design effect of 1.5 (typical for online panels)
deff <- 1.5
n_eff_2018 <- n_2018 / deff
n_eff_2024 <- n_2024 / deff
moe_eff_2018 <- 1.96 * sqrt(0.5 * 0.5 / n_eff_2018) * 100
moe_eff_2024 <- 1.96 * sqrt(0.5 * 0.5 / n_eff_2024) * 100
```

**Central Limit Theorem Implications:**

According to the Central Limit Theorem, with sufficiently large sample sizes, the sampling distribution of proportions approaches a normal distribution, allowing us to make reliable statistical inferences. Both surveys have sample sizes well above the typical threshold (n ≥ 30) required for the CLT to apply.

**Statistical Precision Comparison:**

| Survey | Sample Size | Margin of Error (95% CI) | With Design Effect (1.5) |
|--------|-------------|--------------------------|--------------------------|
| 2018 | `r format(n_2018, big.mark = ",")` | ±`r sprintf("%.2f", moe_2018)`% | ±`r sprintf("%.2f", moe_eff_2018)`% |
| 2024 | `r format(n_2024, big.mark = ",")` | ±`r sprintf("%.2f", moe_2024)`% | ±`r sprintf("%.2f", moe_eff_2024)`% |

**Key Points:**

1. **Both samples are statistically adequate**: With n > 12,000 in both surveys, the Central Limit Theorem ensures the sampling distributions are approximately normal, providing robust statistical properties.

2. **Minimal precision loss**: The 2024 survey has a margin of error only ~`r sprintf("%.2f", moe_2024 - moe_2018)` percentage points wider than 2018. This difference is negligible for practical purposes.

3. **Design effect adjustment**: Assuming a design effect of 1.5 (typical for online panel surveys), effective sample sizes are still large (`r format(round(n_eff_2018), big.mark = ",")` and `r format(round(n_eff_2024), big.mark = ",")` respectively), with margins of error remaining under 1%.

4. **Representativeness vs. Precision**: The more important concern is not statistical precision (both surveys are precise) but **representativeness**:
   - **Why did the sample size drop 31%?** Potential reasons include:
     - Changes in response rates
     - Different sampling frame or recruitment methods
     - Changes in panel composition
     - Different fielding conditions
   
5. **Selection bias risk**: The substantial reduction in sample size may indicate differential non-response or systematic changes in who participates in the survey. This could affect representativeness even though statistical precision remains high.

**Conclusion**: From a pure Central Limit Theorem perspective, both sample sizes are excellent and provide similar statistical precision. However, the unexplained 31% reduction raises questions about potential changes in survey methodology or response patterns that could affect comparability between the two time points.

## Data Loading

```{r}
#| label: load-data

# Load attendance data
attendance_data <- read_csv(here::here("data/bible-society-uk-revival/processed/church-attendance-extracted.csv"))
```

## Survey Question Overview

This section examines how many questions about church attendance were asked in each survey and which questions are comparable.

```{r}
#| label: question-overview
#| echo: false

# Count unique question types per survey
questions_2018 <- attendance_data %>%
  filter(year == 2018) %>%
  distinct(question_type) %>%
  nrow()

questions_2024 <- attendance_data %>%
  filter(year == 2024) %>%
  distinct(question_type) %>%
  nrow()

# Identify common question types
common_questions <- attendance_data %>%
  group_by(question_type) %>%
  summarise(years = n_distinct(year)) %>%
  filter(years == 2) %>%
  nrow()
```

### Question Count Summary

| Survey Year | Number of Church Attendance Questions | Question Types |
|-------------|--------------------------------------|----------------|
| **2018** | `r questions_2018` | Frequency only |
| **2024** | `r questions_2024` | Binary + Frequency |
| **Common Questions** | `r common_questions` | Frequency question |

### Detailed Breakdown

**2018 Survey (1 question):**

1. **Frequency Question**: "Apart from weddings, baptisms/christenings, and funerals how often, if at all, did you go to a church service in the last year?"
   - Response scale: 9 categories from "Daily/almost daily" to "Never"

**2024 Survey (2 questions):**

1. **Binary Question** (NEW): "Have you attended a church service?" 
   - Response options: "Yes - in the past year", "Yes - more than a year ago", "Never"
   - Asked FIRST before the frequency question

2. **Frequency Question** (SAME as 2018): Church attendance frequency
   - Response scale: Same 9 categories as 2018
   - Asked SECOND, after the binary question

### Comparability Assessment

```{r}
#| label: comparability-visual
#| echo: false
#| fig-cap: "Survey question structure comparison"
#| fig-width: 10
#| fig-height: 4

# Create visualization of question structure
question_structure <- tibble(
  Survey = c("2018", "2024", "2024"),
  Question = c("Frequency Question", "Binary Question (NEW)", "Frequency Question"),
  Order = c(1, 1, 2),
  Comparable = c("Yes", "No", "Yes"),
  y_pos = c(2, 1, 1),
  x_pos = c(1, 1, 2)
)

ggplot(question_structure, aes(x = x_pos, y = y_pos)) +
  geom_tile(aes(fill = Comparable), color = "white", linewidth = 2, 
            width = 0.8, height = 0.4, alpha = 0.8) +
  geom_text(aes(label = Question), fontface = "bold", size = 3.5, 
            lineheight = 0.9) +
  geom_text(aes(label = paste0("Order: ", Order)), nudge_y = -0.15, 
            size = 3, color = "grey30") +
  facet_wrap(~Survey, ncol = 2) +
  scale_fill_manual(values = c("Yes" = "#41ab5d", "No" = "#d73027")) +
  labs(
    title = "Survey Question Structure: 2018 vs 2024",
    subtitle = "Green = Directly comparable | Red = Not comparable (unique to 2024)",
    fill = "Comparable?"
  ) +
  theme_void() +
  theme(
    plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
    plot.subtitle = element_text(size = 10, hjust = 0.5, color = "grey40"),
    strip.text = element_text(face = "bold", size = 12),
    legend.position = "bottom",
    plot.margin = margin(10, 10, 10, 10)
  )
```

### Key Observations

1. **Direct Comparability**: Only **1 out of 2** questions from the 2024 survey is directly comparable to 2018 (the frequency question)

2. **Question Order Changed**: Even the comparable frequency question appears in a different context:
   - **2018**: Asked as the only question
   - **2024**: Asked as the second question, after a binary screener

3. **New Binary Question**: The 2024 binary question provides additional data not available in 2018, but also introduces potential **question order effects**

4. **Methodological Implication**: The change from 1 question (2018) to 2 questions (2024) means:
   - 2024 respondents are primed by the binary question before answering the frequency question
   - This priming may affect how they respond to the frequency question
   - The 2018 and 2024 frequency questions are not truly equivalent due to different question contexts

**Conclusion**: While both surveys include a frequency question with identical response categories, the 2024 survey's addition of a binary question asked first creates a different response context. This means **only partial comparability** exists between the two surveys.

## Complete Survey Question Inventory

This section provides a comprehensive inventory of ALL questions asked in both the 2018 and 2024 surveys, showing which questions are common and which are unique to each survey.

### Question Categories

Based on the survey documentation, both surveys covered multiple topics related to religion and church attendance. Below is a complete comparison:

```{r}
#| label: complete-question-inventory
#| echo: false

# Create comprehensive question inventory
question_inventory <- tibble(
  Category = c(
    # Church Attendance
    "Church Attendance", "Church Attendance", "Church Attendance",
    # Religious Identification
    "Religious Identification", "Religious Identification",
    # Bible and Religious Beliefs
    "Bible/Religious Beliefs", "Bible/Religious Beliefs", "Bible/Religious Beliefs",
    # Demographics
    "Demographics", "Demographics", "Demographics"
  ),
  Question_Topic = c(
    # Church Attendance
    "Frequency of church service attendance (past year)",
    "Ever attended church service (binary)",
    "When last attended (if not in past year)",
    # Religious Identification
    "Religious affiliation/denomination",
    "Christian denomination (if Christian)",
    # Bible and Religious Beliefs
    "Bible reading frequency",
    "Bible can change society for the better",
    "Other religious belief questions",
    # Demographics
    "Age group",
    "Ethnicity",
    "Gender"
  ),
  Asked_2018 = c(
    "Yes", "No", "No",
    "Yes", "Yes",
    "Yes", "Yes", "Yes",
    "Yes", "Limited", "Limited"
  ),
  Asked_2024 = c(
    "Yes", "Yes", "Yes",
    "Yes", "Yes",
    "Yes", "Yes", "Yes",
    "Yes", "Yes", "Yes"
  ),
  Directly_Comparable = c(
    "Partial*", "No", "No",
    "Yes", "Yes",
    "Unknown**", "Unknown**", "Unknown**",
    "Yes", "Partial***", "Partial***"
  ),
  Data_Available = c(
    "Yes", "Yes (2024 only)", "Yes (2024 only)",
    "No", "No",
    "No", "No", "No",
    "Yes", "Yes (2024 only)", "Yes (2024 only)"
  )
)

kable(question_inventory, 
      col.names = c("Category", "Question Topic", "2018", "2024", "Comparable?", "Data Available"),
      caption = "Complete inventory of survey questions across both years")
```

**Notes:**

- \* **Partial comparability**: Question wording identical, but asked in different contexts (2024 has binary question first)
- \*\* **Unknown comparability**: Questions asked in both surveys, but exact wording not documented in our data extracts
- \*\*\* **Partial demographic data**: 2018 had limited ethnicity/gender breakdowns compared to 2024

### Summary Statistics

```{r}
#| label: question-summary-stats
#| echo: false

# Calculate summary statistics
total_topics_2018 <- question_inventory %>% filter(Asked_2018 == "Yes") %>% nrow()
total_topics_2024 <- question_inventory %>% filter(Asked_2024 == "Yes") %>% nrow()
common_topics <- question_inventory %>% 
  filter(Asked_2018 == "Yes" & Asked_2024 == "Yes") %>% 
  nrow()
unique_2024 <- question_inventory %>% 
  filter(Asked_2018 == "No" & Asked_2024 == "Yes") %>% 
  nrow()
comparable_topics <- question_inventory %>% 
  filter(Directly_Comparable == "Yes") %>% 
  nrow()
```

| Metric | Count |
|--------|-------|
| **Topics covered in 2018** | `r total_topics_2018` |
| **Topics covered in 2024** | `r total_topics_2024` |
| **Common topics (asked in both)** | `r common_topics` |
| **Unique to 2024** | `r unique_2024` |
| **Directly comparable** | `r comparable_topics` |
| **Data extracted and available for analysis** | 4 topics |

### Visual Summary: Question Coverage

```{r}
#| label: question-coverage-visual
#| fig-cap: "Venn diagram style comparison of survey question coverage"
#| fig-width: 10
#| fig-height: 6
#| echo: false

# Create a visual representation of question overlap
coverage_data <- tibble(
  Survey = c(rep("2018", total_topics_2018), rep("2024", total_topics_2024)),
  Topic_Number = c(1:total_topics_2018, 1:total_topics_2024),
  Category = c(
    question_inventory %>% filter(Asked_2018 == "Yes") %>% pull(Category),
    question_inventory %>% filter(Asked_2024 == "Yes") %>% pull(Category)
  ),
  Status = c(
    question_inventory %>% filter(Asked_2018 == "Yes") %>% 
      mutate(Status = ifelse(Asked_2024 == "Yes", "Common", "2018 Only")) %>% 
      pull(Status),
    question_inventory %>% filter(Asked_2024 == "Yes") %>% 
      mutate(Status = ifelse(Asked_2018 == "Yes", "Common", "2024 Only")) %>% 
      pull(Status)
  )
)

ggplot(coverage_data, aes(x = Survey, fill = Status)) +
  geom_bar(position = "stack", alpha = 0.85, width = 0.6) +
  geom_text(stat = "count", aes(label = after_stat(count)), 
            position = position_stack(vjust = 0.5), 
            fontface = "bold", size = 6, color = "white") +
  scale_fill_manual(values = c("Common" = "#41ab5d", 
                                "2018 Only" = "#4575b4",
                                "2024 Only" = "#d73027")) +
  labs(
    title = "Survey Question Coverage: 2018 vs 2024",
    subtitle = "Number of question topics by survey year",
    x = "Survey Year",
    y = "Number of Question Topics",
    fill = "Status"
  ) +
  theme_comparison() +
  theme(legend.position = "right")
```

### Key Findings from Complete Inventory

1. **Both surveys covered similar topic areas**: Church attendance, religious identification, beliefs about the Bible, and demographics

2. **2024 expanded church attendance questions**: Added binary attendance question and follow-up about when people last attended

3. **Demographic data improved in 2024**: More comprehensive ethnicity and gender breakdowns

4. **Limited data extraction**: Our analysis focuses on church attendance patterns because:
   - These are the questions highlighted in Bible Society UK's "Quiet Revival" claim
   - Full cross-tabulations for other questions were not included in the published reports
   - Demographic data was only partially available for 2018

5. **Comparability challenges**: Even for topics covered in both years:
   - Question wording may have changed (not fully documented)
   - Response scales may differ
   - Question context/ordering changed
   - Demographic weighting methodology not disclosed

### Data Availability for Analysis

Of all the questions asked across both surveys, we have extracted and analyzable data for:

- ✅ **Church attendance frequency** (both years)
- ✅ **Binary church attendance** (2024 only)
- ✅ **Age breakdowns** (both years)
- ✅ **Ethnicity breakdowns** (2024 only, limited in 2018)
- ✅ **Gender breakdowns** (2024 only)

For other questions (religious identification, Bible reading, beliefs), the published reports provided:
- Summary statistics only (no cross-tabulations)
- Selected highlights (not comprehensive data)
- Insufficient detail for rigorous comparative analysis

This limitation means our analysis necessarily focuses on what data is available: church attendance patterns and basic demographic breakdowns.

## Question Format Comparison

### 2018 Survey Question

**Question wording**: "Apart from weddings, baptisms/christenings, and funerals how often, if at all, did you go to a church service in the last year?"

**Response options**:
- Daily/almost daily
- A few times a week
- About once a week
- About once a fortnight
- About once a month
- A few times a year
- About once a year
- Hardly ever
- Never

### 2024 Survey Questions

**Two separate questions were asked:**

**Question 1 (Binary)**: "Have you attended a church service?" [exact wording not fully documented]

**Response options**:
- Yes - in the past year
- Yes - more than a year ago
- Never

**Question 2 (Frequency)**: Same frequency scale as 2018

⚠️ **Important methodological note**: The binary question was asked BEFORE the frequency question in 2024, which was not the case in 2018. This ordering may influence responses.

## Complete Attendance Distribution Comparison

### Frequency Question Responses

This is the most directly comparable question between the two surveys.

```{r}
#| label: frequency-distribution-table

# Extract frequency responses for both years
freq_2018 <- attendance_data %>%
  filter(year == 2018, 
         !response_category %in% c("At least once a week", "At least once a month")) %>%
  select(response_category, total_pct) %>%
  rename(`2018 (%)` = total_pct)

freq_2024 <- attendance_data %>%
  filter(year == 2024, question_type == "frequency",
         !response_category %in% c("At least once a week", "At least once a month")) %>%
  select(response_category, total_pct) %>%
  rename(`2024 (%)` = total_pct)

# Merge and calculate changes
freq_comparison <- full_join(freq_2018, freq_2024, by = "response_category") %>%
  mutate(
    `Change (pp)` = `2024 (%)` - `2018 (%)`,
    `Change (%)` = round((`2024 (%)` / `2018 (%)` - 1) * 100, 1)
  ) %>%
  arrange(desc(`2018 (%)`))

kable(freq_comparison, digits = 1, 
      caption = "Church attendance frequency: 2018 vs 2024")
```

### Visual Comparison: Complete Distribution

```{r}
#| label: full-distribution-visual
#| fig-cap: "Complete church attendance distribution comparison"
#| fig-width: 12
#| fig-height: 7

# Prepare data for plotting
plot_data <- attendance_data %>%
  filter(
    (year == 2018) | (year == 2024 & question_type == "frequency")
  ) %>%
  filter(!response_category %in% c("At least once a week", "At least once a month")) %>%
  mutate(
    Year = factor(year),
    response_category = factor(response_category, levels = c(
      "Daily/almost daily", "A few times a week", "About once a week",
      "About once a fortnight", "About once a month", "A few times a year",
      "About once a year", "Hardly ever", "Never"
    ))
  )

ggplot(plot_data, aes(x = response_category, y = total_pct, fill = Year)) +
  geom_col(position = "dodge", alpha = 0.8, width = 0.7) +
  geom_text(aes(label = sprintf("%.1f%%", total_pct)), 
            position = position_dodge(width = 0.7), 
            vjust = -0.3, size = 3.5, fontface = "bold") +
  scale_fill_manual(values = c("2018" = "#4575b4", "2024" = "#d73027"),
                    labels = c("2018" = "2018 (n=19,875)", "2024" = "2024 (n=12,455)")) +
  labs(
    title = "Church Attendance Frequency Distribution: 2018 vs 2024",
    subtitle = "Direct comparison of identical question format",
    x = "Attendance Frequency",
    y = "Percentage of Respondents (%)",
    fill = "Survey Year"
  ) +
  theme_comparison() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "top"
  ) +
  scale_y_continuous(limits = c(0, 70), breaks = seq(0, 70, 10))
```

### Change Magnitude Visualisation

```{r}
#| label: change-magnitude-visual
#| fig-cap: "Magnitude and direction of changes in attendance categories"
#| fig-width: 10
#| fig-height: 6

# Prepare data for diverging bar chart
change_plot_data <- freq_comparison %>%
  mutate(
    response_category = factor(response_category, 
                               levels = rev(response_category)),
    Direction = case_when(
      `Change (pp)` > 0 ~ "Increase",
      `Change (pp)` < 0 ~ "Decrease",
      TRUE ~ "No Change"
    )
  )

ggplot(change_plot_data, aes(x = response_category, y = `Change (pp)`, fill = Direction)) +
  geom_col(alpha = 0.85, width = 0.7) +
  geom_text(aes(label = sprintf("%+.1f", `Change (pp)`)), 
            hjust = ifelse(change_plot_data$`Change (pp)` > 0, -0.2, 1.2),
            size = 4, fontface = "bold") +
  geom_hline(yintercept = 0, color = "black", linewidth = 0.8) +
  scale_fill_manual(values = c("Increase" = "#2166ac", "Decrease" = "#d73027")) +
  coord_flip() +
  labs(
    title = "Change in Attendance by Category: 2018 → 2024",
    subtitle = "Percentage point change for each response category",
    x = NULL,
    y = "Change (percentage points)",
    fill = "Direction"
  ) +
  theme_comparison() +
  theme(
    panel.grid.major.y = element_blank()
  )
```

## Summary Statistics: Grouped Categories

### Weekly and Monthly Attendance

```{r}
#| label: grouped-categories

# Calculate grouped statistics
grouped_stats <- tibble(
  Category = c("At least once a week", "At least once a month", "Never"),
  `2018 (%)` = c(
    attendance_data %>% filter(year == 2018, response_category == "At least once a week") %>% pull(total_pct),
    attendance_data %>% filter(year == 2018, response_category == "At least once a month") %>% pull(total_pct),
    attendance_data %>% filter(year == 2018, response_category == "Never") %>% pull(total_pct)
  ),
  `2024 (%)` = c(
    # Weekly: sum of daily + few times a week + once a week
    attendance_data %>% 
      filter(year == 2024, question_type == "frequency",
             response_category %in% c("Daily/almost daily", "A few times a week", "About once a week")) %>%
      pull(total_pct) %>% sum(),
    # Monthly: weekly + fortnight + month
    attendance_data %>% 
      filter(year == 2024, question_type == "frequency",
             response_category %in% c("Daily/almost daily", "A few times a week", "About once a week",
                                     "About once a fortnight", "About once a month")) %>%
      pull(total_pct) %>% sum(),
    # Never
    attendance_data %>% filter(year == 2024, question_type == "frequency", response_category == "Never") %>% pull(total_pct)
  )
) %>%
  mutate(
    `Change (pp)` = `2024 (%)` - `2018 (%)`,
    `Relative Change (%)` = round((`2024 (%)` / `2018 (%)` - 1) * 100, 1)
  )

kable(grouped_stats, digits = 1, 
      caption = "Grouped attendance categories comparison")
```

```{r}
#| label: grouped-visual
#| fig-cap: "Comparison of grouped attendance categories"
#| fig-width: 10
#| fig-height: 5

# Reshape for plotting
grouped_plot_data <- grouped_stats %>%
  select(Category, `2018 (%)`, `2024 (%)`) %>%
  pivot_longer(cols = c(`2018 (%)`, `2024 (%)`), 
               names_to = "Year", values_to = "Percentage") %>%
  mutate(
    Year = str_extract(Year, "\\d{4}"),
    Category = factor(Category, levels = c("At least once a week", "At least once a month", "Never"))
  )

ggplot(grouped_plot_data, aes(x = Category, y = Percentage, fill = Year)) +
  geom_col(position = "dodge", alpha = 0.85, width = 0.7) +
  geom_text(aes(label = sprintf("%.1f%%", Percentage)), 
            position = position_dodge(width = 0.7), 
            vjust = -0.3, size = 4, fontface = "bold") +
  scale_fill_manual(values = c("2018" = "#4575b4", "2024" = "#d73027")) +
  labs(
    title = "Grouped Attendance Categories: 2018 vs 2024",
    subtitle = "Weekly and monthly attendance show increases; 'Never' shows decrease",
    x = NULL,
    y = "Percentage (%)",
    fill = "Survey Year"
  ) +
  theme_comparison() +
  theme(
    axis.text.x = element_text(angle = 20, hjust = 1)
  ) +
  scale_y_continuous(limits = c(0, 70), breaks = seq(0, 70, 10))
```

## Demographic Breakdowns

### By Age Group

```{r}
#| label: age-breakdown-table

# Get weekly attendance by age for 2018
age_2018 <- attendance_data %>%
  filter(year == 2018, response_category == "At least once a week") %>%
  select(age_18_34, age_35_54, age_55plus)

# Get weekly attendance by age for 2024
age_2024 <- attendance_data %>%
  filter(
    year == 2024,
    question_type == "frequency",
    response_category %in% c("Daily/almost daily", "A few times a week", "About once a week")
  ) %>%
  summarise(
    age_18_34 = sum(age_18_34, na.rm = TRUE),
    age_35_54 = sum(age_35_54, na.rm = TRUE),
    age_55plus = sum(age_55plus, na.rm = TRUE)
  )

# Create comparison table
age_comparison <- tibble(
  `Age Group` = c("18-34", "35-54", "55+"),
  `2018 (%)` = c(age_2018$age_18_34, age_2018$age_35_54, age_2018$age_55plus),
  `2024 (%)` = c(age_2024$age_18_34, age_2024$age_35_54, age_2024$age_55plus)
) %>%
  mutate(
    `Change (pp)` = `2024 (%)` - `2018 (%)`,
    `Relative Change (%)` = round((`2024 (%)` / `2018 (%)` - 1) * 100, 1)
  )

kable(age_comparison, digits = 1, 
      caption = "Weekly+ church attendance by age group")
```

```{r}
#| label: age-visual
#| fig-cap: "Weekly+ attendance by age group: 2018 vs 2024"
#| fig-width: 10
#| fig-height: 6

# Reshape for plotting
age_plot_data <- age_comparison %>%
  select(`Age Group`, `2018 (%)`, `2024 (%)`) %>%
  pivot_longer(cols = c(`2018 (%)`, `2024 (%)`), 
               names_to = "Year", values_to = "Percentage") %>%
  mutate(Year = str_extract(Year, "\\d{4}"))

ggplot(age_plot_data, aes(x = `Age Group`, y = Percentage, fill = Year)) +
  geom_col(position = "dodge", alpha = 0.85, width = 0.6) +
  geom_text(aes(label = sprintf("%.1f%%", Percentage)), 
            position = position_dodge(width = 0.6), 
            vjust = -0.3, size = 4, fontface = "bold") +
  scale_fill_manual(values = c("2018" = "#4575b4", "2024" = "#d73027")) +
  labs(
    title = "Weekly+ Church Attendance by Age Group",
    subtitle = "Comparison between 2018 and 2024",
    x = "Age Group",
    y = "Percentage Attending Weekly or More (%)",
    fill = "Survey Year"
  ) +
  theme_comparison() +
  scale_y_continuous(limits = c(0, 20), breaks = seq(0, 20, 5))
```

### Change by Age Group

```{r}
#| label: age-change-visual
#| fig-cap: "Absolute change in weekly+ attendance by age group"
#| fig-width: 10
#| fig-height: 5

ggplot(age_comparison, aes(x = `Age Group`, y = `Change (pp)`)) +
  geom_col(fill = "#2166ac", alpha = 0.85, width = 0.6) +
  geom_text(aes(label = sprintf("%+.1f pp", `Change (pp)`)), 
            vjust = -0.5, size = 5, fontface = "bold") +
  geom_hline(yintercept = 0, linewidth = 0.8) +
  labs(
    title = "Change in Weekly+ Attendance by Age Group (2018 → 2024)",
    subtitle = "All age groups show increases, with 18-34 showing the largest change",
    x = "Age Group",
    y = "Change (percentage points)"
  ) +
  theme_comparison() +
  scale_y_continuous(limits = c(0, 9), breaks = seq(0, 9, 1), 
                     expand = expansion(mult = c(0, 0.05)))
```

### By Ethnicity (2024 Only)

The 2024 survey includes ethnicity breakdowns that were not available in 2018.

```{r}
#| label: ethnicity-table

# Get 2024 binary attendance by ethnicity
ethnicity_data <- attendance_data %>%
  filter(year == 2024, question_type == "binary", 
         response_category == "Yes - in the past year") %>%
  select(white, ethnic_minority)

ethnicity_table <- tibble(
  `Ethnic Group` = c("White", "Ethnic Minority"),
  `Attended in Past Year (%)` = c(ethnicity_data$white, ethnicity_data$ethnic_minority),
  `Difference from White (pp)` = c(0, ethnicity_data$ethnic_minority - ethnicity_data$white)
)

kable(ethnicity_table, digits = 1, 
      caption = "Church attendance by ethnicity (2024 survey only)")
```

```{r}
#| label: ethnicity-visual
#| fig-cap: "Church attendance by ethnicity (2024)"
#| fig-width: 8
#| fig-height: 5

ggplot(ethnicity_table, aes(x = `Ethnic Group`, y = `Attended in Past Year (%)`)) +
  geom_col(fill = c("#4575b4", "#d73027"), alpha = 0.85, width = 0.6) +
  geom_text(aes(label = sprintf("%.1f%%", `Attended in Past Year (%)`)), 
            vjust = -0.3, size = 5, fontface = "bold") +
  labs(
    title = "Church Attendance by Ethnicity (2024)",
    subtitle = "Percentage attending in the past year",
    x = "Ethnic Group",
    y = "Attended in Past Year (%)"
  ) +
  theme_comparison() +
  scale_y_continuous(limits = c(0, 30), breaks = seq(0, 30, 5))
```

### By Gender (2024 Only)

```{r}
#| label: gender-table

# Get 2024 binary attendance by gender
gender_data <- attendance_data %>%
  filter(year == 2024, question_type == "binary", 
         response_category == "Yes - in the past year") %>%
  select(male, female)

gender_table <- tibble(
  Gender = c("Male", "Female"),
  `Attended in Past Year (%)` = c(gender_data$male, gender_data$female),
  `Difference from Male (pp)` = c(0, gender_data$female - gender_data$male)
)

kable(gender_table, digits = 1, 
      caption = "Church attendance by gender (2024 survey only)")
```

```{r}
#| label: gender-visual
#| fig-cap: "Church attendance by gender (2024)"
#| fig-width: 8
#| fig-height: 5

ggplot(gender_table, aes(x = Gender, y = `Attended in Past Year (%)`)) +
  geom_col(fill = c("#4575b4", "#d73027"), alpha = 0.85, width = 0.5) +
  geom_text(aes(label = sprintf("%.1f%%", `Attended in Past Year (%)`)), 
            vjust = -0.3, size = 5, fontface = "bold") +
  labs(
    title = "Church Attendance by Gender (2024)",
    subtitle = "Percentage attending in the past year",
    x = "Gender",
    y = "Attended in Past Year (%)"
  ) +
  theme_comparison() +
  scale_y_continuous(limits = c(0, 30), breaks = seq(0, 30, 5))
```

## 2024 Binary Question Results

The 2024 survey included an additional binary question asked before the frequency question.

```{r}
#| label: binary-question-table

binary_data <- attendance_data %>%
  filter(year == 2024, question_type == "binary") %>%
  select(response_category, total_pct) %>%
  rename(`Percentage (%)` = total_pct)

kable(binary_data, digits = 1, 
      caption = "2024 binary question responses")
```

```{r}
#| label: binary-visual
#| fig-cap: "2024 binary question responses"
#| fig-width: 10
#| fig-height: 6

ggplot(binary_data, aes(x = reorder(response_category, -`Percentage (%)`), 
                        y = `Percentage (%)`)) +
  geom_col(fill = c("#d73027", "#fdae61", "#4575b4", "#91bfdb"), 
           alpha = 0.85, width = 0.6) +
  geom_text(aes(label = sprintf("%.1f%%", `Percentage (%)`)), 
            vjust = -0.3, size = 5, fontface = "bold") +
  labs(
    title = "Binary Question Responses (2024)",
    subtitle = "Have you attended a church service?",
    x = "Response",
    y = "Percentage (%)"
  ) +
  theme_comparison() +
  theme(axis.text.x = element_text(angle = 20, hjust = 1)) +
  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 10))
```

## Internal Consistency Check (2024)

We can check whether the binary and frequency questions in 2024 give consistent results.

```{r}
#| label: consistency-check

# Calculate sum of frequency responses for past year attendance in 2024
freq_sum_2024 <- attendance_data %>%
  filter(year == 2024, question_type == "frequency") %>%
  filter(response_category %in% c(
    "Daily/almost daily", "A few times a week", 
    "About once a week", "About once a fortnight",
    "About once a month", "A few times a year",
    "About once a year"
  )) %>%
  pull(total_pct) %>%
  sum()

# Get binary response
binary_2024 <- attendance_data %>%
  filter(year == 2024, question_type == "binary", 
         response_category == "Yes - in the past year") %>%
  pull(total_pct)

consistency <- tibble(
  Measure = c("Binary: 'Yes - in the past year'", 
              "Frequency: Sum of all 'past year' categories",
              "Discrepancy"),
  Value = c(binary_2024, freq_sum_2024, abs(freq_sum_2024 - binary_2024))
)

kable(consistency, digits = 1, col.names = c("Measure", "Percentage (%)"),
      caption = "Internal consistency check: 2024 survey")
```

```{r}
#| label: consistency-visual
#| fig-cap: "Internal consistency comparison"
#| fig-width: 8
#| fig-height: 5

consistency_plot <- tibble(
  Measure = c("Binary Question\n('Yes - in past year')", 
              "Frequency Question\n(Sum of past year categories)"),
  Value = c(binary_2024, freq_sum_2024)
)

ggplot(consistency_plot, aes(x = Measure, y = Value)) +
  geom_col(fill = c("#d73027", "#4575b4"), alpha = 0.85, width = 0.6) +
  geom_text(aes(label = sprintf("%.1f%%", Value)), 
            vjust = -0.3, size = 6, fontface = "bold") +
  geom_segment(aes(x = 1, xend = 2, y = binary_2024, yend = freq_sum_2024),
               linetype = "dashed", linewidth = 1, color = "grey40") +
  annotate("text", x = 1.5, y = (binary_2024 + freq_sum_2024)/2, 
           label = sprintf("Difference:\n%.1f pp", abs(freq_sum_2024 - binary_2024)),
           size = 4, fontface = "italic") +
  labs(
    title = "Internal Consistency Check: 2024 Survey",
    subtitle = "Do the binary and frequency questions give the same answer?",
    x = NULL,
    y = "Percentage (%)"
  ) +
  theme_comparison() +
  scale_y_continuous(limits = c(0, 30), breaks = seq(0, 30, 5))
```

**Observation**: The two measures differ by `r sprintf("%.1f", abs(freq_sum_2024 - binary_2024))` percentage points. These should theoretically be identical if measuring the same construct.

## Summary Dashboard

```{r}
#| label: summary-dashboard
#| fig-cap: "Summary dashboard of key findings"
#| fig-width: 12
#| fig-height: 10
#| echo: false

# Create summary metrics
p1 <- ggplot(grouped_stats %>% filter(Category == "At least once a week"), 
             aes(x = 1)) +
  geom_segment(aes(x = 1, xend = 1, y = `2018 (%)`, yend = `2024 (%)`),
               arrow = arrow(length = unit(0.3, "cm")), 
               linewidth = 3, color = "#2166ac") +
  geom_point(aes(y = `2018 (%)`), size = 12, color = "#4575b4") +
  geom_point(aes(y = `2024 (%)`), size = 12, color = "#d73027") +
  geom_text(aes(y = `2018 (%)`, label = sprintf("%.0f%%", `2018 (%)`)), 
            color = "white", fontface = "bold", size = 3) +
  geom_text(aes(y = `2024 (%)`, label = sprintf("%.0f%%", `2024 (%)`)), 
            color = "white", fontface = "bold", size = 3) +
  annotate("text", x = 1, y = 14, label = sprintf("+%.1fpp", grouped_stats$`Change (pp)`[1]), 
           fontface = "bold", size = 6, color = "#2166ac") +
  labs(title = "Weekly+ Attendance", subtitle = "2018 → 2024") +
  theme_void() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 13),
        plot.subtitle = element_text(hjust = 0.5, size = 10)) +
  ylim(0, 15)

p2 <- ggplot(grouped_stats %>% filter(Category == "Never"), 
             aes(x = 1)) +
  geom_segment(aes(x = 1, xend = 1, y = `2018 (%)`, yend = `2024 (%)`),
               arrow = arrow(length = unit(0.3, "cm")), 
               linewidth = 3, color = "#a50f15") +
  geom_point(aes(y = `2018 (%)`), size = 12, color = "#4575b4") +
  geom_point(aes(y = `2024 (%)`), size = 12, color = "#d73027") +
  geom_text(aes(y = `2018 (%)`, label = sprintf("%.0f%%", `2018 (%)`)), 
            color = "white", fontface = "bold", size = 3) +
  geom_text(aes(y = `2024 (%)`, label = sprintf("%.0f%%", `2024 (%)`)), 
            color = "white", fontface = "bold", size = 3) +
  annotate("text", x = 1, y = 55, label = sprintf("%.1fpp", grouped_stats$`Change (pp)`[3]), 
           fontface = "bold", size = 6, color = "#a50f15") +
  labs(title = "Never Attended", subtitle = "2018 → 2024") +
  theme_void() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 13),
        plot.subtitle = element_text(hjust = 0.5, size = 10)) +
  ylim(50, 70)

p3 <- ggplot(age_comparison, aes(x = `Age Group`, y = `Change (pp)`)) +
  geom_col(fill = "#2166ac", alpha = 0.85) +
  geom_text(aes(label = sprintf("%+.1f", `Change (pp)`)), 
            vjust = -0.3, size = 4, fontface = "bold") +
  labs(title = "Change by Age Group", 
       subtitle = "Weekly+ attendance change (pp)",
       x = NULL, y = "Change (pp)") +
  theme_comparison() +
  theme(plot.title = element_text(size = 13))

p4 <- ggplot(consistency_plot, aes(x = Measure, y = Value)) +
  geom_col(fill = c("#d73027", "#4575b4"), alpha = 0.85) +
  geom_text(aes(label = sprintf("%.1f%%", Value)), 
            vjust = -0.3, size = 4, fontface = "bold") +
  labs(title = "2024 Consistency Check",
       subtitle = "Binary vs Frequency",
       x = NULL, y = "%") +
  theme_comparison() +
  theme(
    plot.title = element_text(size = 13),
    axis.text.x = element_text(size = 8)
  )

# Combine plots
(p1 | p2) / (p3 | p4) +
  plot_annotation(
    title = "Key Findings Summary: 2018 vs 2024",
    subtitle = "Comprehensive overview of main attendance pattern changes",
    theme = theme(
      plot.title = element_text(size = 16, face = "bold"),
      plot.subtitle = element_text(size = 12)
    )
  )
```

## Key Observations

### Main Findings

1. **Weekly+ attendance increased** from 7% (2018) to 11% (2024) - a change of **+4 percentage points**

2. **"Never attended" decreased** from 63% (2018) to 59% (2024) - a change of **-4 percentage points**

3. **All changes are relatively small** - no category changed by more than 4 percentage points

4. **Age patterns**: The youngest age group (18-34) showed the largest increase in weekly attendance (+7.0pp), compared to middle (+1.0pp) and older (+2.0pp) age groups

5. **Internal consistency**: The 2024 binary and frequency questions show a discrepancy of `r sprintf("%.1f", abs(freq_sum_2024 - binary_2024))` percentage points

6. **Sample size**: The 2024 survey has 31% fewer respondents than 2018

7. **Demographic differences**: Ethnic minority respondents show different attendance patterns than White respondents in 2024

## Methodological Notes

**Question format differences**:
- 2018: Single frequency question only
- 2024: Binary question FIRST, then frequency question
- This difference in question order may affect comparability

**Sample size changes**:
- 2018: 19,875 (weighted)
- 2024: 12,455 (weighted)
- Represents a 31% reduction

**Demographic data availability**:
- Ethnicity and gender breakdowns only available for 2024
- This limits ability to assess population composition changes

## Next Steps

For critical analysis of these findings, see:

- [**Critical Analysis Overview**](./criticism-overview.qmd) - Evaluation of methodological quality and alternative explanations
- [**Weekly Attendance Claim**](./weekly-attendance-claim.qmd) - Statistical testing of the observed changes
- [**Question Order Effects**](./question-order-effects.qmd) - Impact of methodological differences
- [**Demographic Analysis**](./demographic-analysis.qmd) - Population composition effects

